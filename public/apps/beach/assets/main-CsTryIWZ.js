var re=Object.defineProperty;var ce=(d,e,t)=>e in d?re(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var o=(d,e,t)=>ce(d,typeof e!="symbol"?e+"":e,t);import{G as F,s as le,V as y,M as x,a as g,B as G,P as R,C as I,D as O,b as te,S as he,E as se,A as de,c as ue,d as me,e as q,f as fe,g as X,h as A,i as C,T as ie,j as pe,F as ge,k as we,R as $,N as Q,l as k,m as ve,n as ye,o as K,p as xe,W as be,q as ke,r as Me,t as Se,u as Pe,v as Le,w as J,Q as De,x as Ne,y as Z,z as r,H as v,I as oe,O as ne,J as Te,K as je,L as Ee,U as Ce,X as Ae}from"./vendor-B54fIOLJ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class Fe{constructor(e,t){o(this,"scene");o(this,"terrain");o(this,"furnitureGroup");o(this,"rng");this.scene=e,this.terrain=t,this.furnitureGroup=new F,this.scene.add(this.furnitureGroup),this.rng=le("beach-furniture-42"),this.createInitialFurniture()}createInitialFurniture(){const e=[{pos:new y(5,0,8),type:"chair",rotation:Math.PI/4},{pos:new y(3,0,10),type:"umbrella",rotation:0},{pos:new y(-8,0,12),type:"chair",rotation:-Math.PI/3},{pos:new y(-6,0,14),type:"chair",rotation:Math.PI/6},{pos:new y(-10,0,16),type:"umbrella",rotation:Math.PI/2},{pos:new y(12,0,6),type:"chair",rotation:Math.PI},{pos:new y(14,0,8),type:"umbrella",rotation:-Math.PI/4},{pos:new y(-2,0,18),type:"chair",rotation:Math.PI/2}];for(const t of e){const s=this.terrain.getHeightAt(t.pos.x,t.pos.z);t.pos.y=s,t.type==="chair"?this.createBeachChair(t.pos,t.rotation):t.type==="umbrella"&&this.createUmbrella(t.pos,t.rotation)}}createBeachChair(e,t=0){const s=new F,i=new x({color:9127187,roughness:.8,metalness:.2}),n=new g(new G(1.2,.1,.8),i);n.position.y=.3,s.add(n);const a=new g(new G(1.2,.1,.8),i);a.position.set(0,.7,-.7),a.rotation.x=Math.PI/4,s.add(a);const c=new G(.05,.3,.05),l=[new y(-.5,.15,.3),new y(.5,.15,.3),new y(-.5,.15,-.3),new y(.5,.15,-.3)];for(const p of l){const m=new g(c,i);m.position.copy(p),s.add(m)}const u=new x({color:2003199,roughness:.9,metalness:.1}),h=new g(new R(1.1,.7),u);h.position.set(0,.38,0),h.rotation.x=-Math.PI/2,s.add(h);const f=new g(new R(1.1,.7),u);f.position.set(0,.7,-.6),f.rotation.x=-Math.PI/4,s.add(f),s.position.copy(e),s.rotation.y=t,s.castShadow=!0,s.receiveShadow=!0,this.furnitureGroup.add(s)}createUmbrella(e,t=0){const s=new F,i=new x({color:9127187,roughness:.8,metalness:.2}),n=new g(new I(.05,.05,2.5,8),i);n.position.y=1.25,s.add(n);const a=new x({color:16711680,roughness:.9,metalness:.1,side:O}),c=new te(1.2,1,8),l=new g(c,a);l.position.y=2.5,l.rotation.x=0,s.add(l),s.position.copy(e),s.rotation.y=t,s.castShadow=!0,s.receiveShadow=!0;const u=this.rng()*.5+.3,h=this.rng()*Math.PI*2,f=Math.cos(h)*u,p=Math.sin(h)*u;s.position.x+=f,s.position.z+=p,this.furnitureGroup.add(s)}dispose(){this.scene.remove(this.furnitureGroup),this.furnitureGroup.traverse(e=>{if(e instanceof g)if(e.geometry.dispose(),Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()})}}class ze{constructor(){o(this,"cloudGroup");o(this,"clouds",[]);o(this,"windDirection");o(this,"windSpeed");this.cloudGroup=new F,this.windDirection=new y(1,0,0).normalize(),this.windSpeed=.1,this.createClouds()}createClouds(){for(let n=0;n<15;n++){const a=new F,c=Math.floor(Math.random()*3)+3;for(let l=0;l<c;l++){const u=5*(.5+Math.random()*.5),h=new he(u,8,8),f=new x({color:16777215,transparent:!0,opacity:.8,roughness:.9,side:O}),p=new g(h,f);p.castShadow=!1,p.receiveShadow=!1,p.position.set((Math.random()-.5)*u*2,(Math.random()-.5)*u,(Math.random()-.5)*u*2),a.add(p)}a.position.set((Math.random()-.5)*100,20+Math.random()*10,(Math.random()-.5)*100),this.cloudGroup.add(a),this.clouds.push(a)}}update(e){for(const t of this.clouds)t.position.add(this.windDirection.clone().multiplyScalar(this.windSpeed*e)),t.position.x>50?t.position.x=-50:t.position.x<-50&&(t.position.x=50),t.position.z>50?t.position.z=-50:t.position.z<-50&&(t.position.z=50)}getCloudGroup(){return this.cloudGroup}}class Ie{constructor(e,t,s,i,n){o(this,"camera");o(this,"scene");o(this,"terrain");o(this,"sceneManager");o(this,"jukebox");o(this,"canvas");o(this,"moveForward",!1);o(this,"moveBackward",!1);o(this,"moveLeft",!1);o(this,"moveRight",!1);o(this,"moveUp",!1);o(this,"moveDown",!1);o(this,"canJump",!0);o(this,"isFlyMode",!1);o(this,"velocity",new y);o(this,"direction",new y);o(this,"verticalVelocity",0);o(this,"movementSpeed",5);o(this,"jumpHeight",10);o(this,"gravity",30);o(this,"flySpeed",5);o(this,"isPointerLocked",!1);o(this,"euler",new se(0,0,0,"YXZ"));o(this,"mouseSensitivity",.002);o(this,"playerHeight",1.7);o(this,"onPointerLockChange",()=>{this.isPointerLocked=document.pointerLockElement===this.canvas});o(this,"onPointerLockError",()=>{console.error("Pointer lock error")});o(this,"onCanvasClick",()=>{this.isPointerLocked||this.canvas.requestPointerLock()});o(this,"onMouseMove",e=>{this.isPointerLocked&&(this.euler.setFromQuaternion(this.camera.quaternion),this.euler.y-=e.movementX*this.mouseSensitivity,this.euler.x-=e.movementY*this.mouseSensitivity,this.euler.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.euler.x)),this.camera.quaternion.setFromEuler(this.euler))});o(this,"onKeyDown",e=>{switch(e.code){case"KeyW":this.moveForward=!0;break;case"KeyS":this.moveBackward=!0;break;case"KeyA":this.moveLeft=!0;break;case"KeyD":this.moveRight=!0;break;case"KeyQ":this.isFlyMode&&(this.moveDown=!0);break;case"KeyE":this.isFlyMode&&(this.moveUp=!0);break;case"Space":this.canJump&&!this.isFlyMode&&(this.verticalVelocity=this.jumpHeight,this.camera.position.y+=.1,this.canJump=!1);break;case"KeyF":this.isFlyMode=!this.isFlyMode,this.isFlyMode?(this.verticalVelocity=0,this.canJump=!1):(this.moveUp=!1,this.moveDown=!1);break;case"KeyT":this.sceneManager.toggleWireframeMode();break;case"KeyN":this.jukebox.nextSong();break}});o(this,"onKeyUp",e=>{switch(e.code){case"KeyW":this.moveForward=!1;break;case"KeyS":this.moveBackward=!1;break;case"KeyA":this.moveLeft=!1;break;case"KeyD":this.moveRight=!1;break;case"KeyQ":this.moveDown=!1;break;case"KeyE":this.moveUp=!1;break}});this.camera=e,this.scene=t,this.terrain=s,this.sceneManager=i,this.jukebox=n,this.canvas=document.getElementById("scene-canvas");const a=(Math.random()-.5)*100,c=(Math.random()-.5)*100,l=this.terrain.getHeightAt(a,c)+this.playerHeight;this.camera.position.set(a,l,c);const u=new y(a,0,c).normalize(),h=Math.atan2(u.x,u.z);this.euler.set(0,h,0),this.camera.quaternion.setFromEuler(this.euler),this.initPointerLock(),this.initKeyboardControls()}initPointerLock(){document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1),this.canvas.addEventListener("click",this.onCanvasClick),document.addEventListener("mousemove",this.onMouseMove)}initKeyboardControls(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}update(e){if(!this.isPointerLocked)return;if(this.isFlyMode){const a=(Number(this.moveUp)-Number(this.moveDown))*this.flySpeed*e;this.camera.position.y+=a}else{const a=this.terrain.getHeightAt(this.camera.position.x,this.camera.position.z);this.camera.position.y>a+this.playerHeight?(this.verticalVelocity-=this.gravity*e,this.camera.position.y+=this.verticalVelocity*e,this.canJump=!1):(this.camera.position.y=a+this.playerHeight,this.verticalVelocity=0,this.canJump=!0)}this.direction.z=Number(this.moveForward)-Number(this.moveBackward),this.direction.x=Number(this.moveLeft)-Number(this.moveRight),this.direction.normalize(),this.velocity.z=this.direction.z*this.movementSpeed*e,this.velocity.x=this.direction.x*this.movementSpeed*e;const t=new y;this.camera.getWorldDirection(t),t.y=0,t.normalize();const s=new y().crossVectors(new y(0,1,0),t).normalize(),i=this.velocity.x*s.x+this.velocity.z*t.x,n=this.velocity.x*s.z+this.velocity.z*t.z;this.camera.position.x+=i,this.camera.position.z+=n}dispose(){document.removeEventListener("pointerlockchange",this.onPointerLockChange),document.removeEventListener("pointerlockerror",this.onPointerLockError),this.canvas.removeEventListener("click",this.onCanvasClick),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.pointerLockElement===this.canvas&&document.exitPointerLock()}savePosition(){}loadPosition(){}resetPosition(){const e=(Math.random()-.5)*100,t=(Math.random()-.5)*100,s=this.terrain.getHeightAt(e,t)+this.playerHeight;this.camera.position.set(e,s,t),this.camera.rotation.set(0,0,0),this.euler.set(0,0,0),this.camera.quaternion.setFromEuler(this.euler),this.verticalVelocity=0}getPosition(){return this.camera.position.clone()}getRotationY(){return this.euler.y}}class Y extends Event{constructor(e){super("songchange"),this.songTitle=e}}class He{constructor(e,t){o(this,"scene");o(this,"terrain");o(this,"jukeboxGroup");o(this,"audioListener");o(this,"audio");o(this,"isPlaying",!1);o(this,"isMuted",!1);o(this,"lastVolume",.3);o(this,"currentSong",Math.floor(Math.random()*2));o(this,"songs",["ost/Vibe Beach.mp3","ost/Goth Vibe Beach.mp3"]);o(this,"songTitles",["Sunset Serenade - Jack Sanderson & The Beachcombers","Midnight Tide - Luna Blackwood"]);o(this,"initAudioHandler",null);this.scene=e,this.terrain=t,this.jukeboxGroup=new F,this.audioListener=new de,this.audio=new ue(this.audioListener),this.createJukeboxModel(),this.setupAudio(),this.scene.add(this.jukeboxGroup),this.initAudioHandler=()=>{this.isPlaying||(this.audio.play(),this.isPlaying=!0),this.removeInitListeners()},this.addInitListeners()}addInitListeners(){this.initAudioHandler&&(document.addEventListener("click",this.initAudioHandler),document.addEventListener("keydown",this.initAudioHandler))}removeInitListeners(){this.initAudioHandler&&(document.removeEventListener("click",this.initAudioHandler),document.removeEventListener("keydown",this.initAudioHandler),this.initAudioHandler=null)}dispose(){this.audio.isPlaying&&this.audio.stop(),this.isPlaying=!1,this.removeInitListeners(),this.scene.remove(this.jukeboxGroup),this.audio.buffer&&(this.audio.buffer=null),this.audio.disconnect()}createJukeboxModel(){const e=new G(1.2,.1,.8),t=new x({color:9127187,roughness:.8,metalness:.2}),s=new g(e,t);s.position.y=.05,this.jukeboxGroup.add(s);const i=new G(1,1.2,.6),n=new x({color:2003199,roughness:.7,metalness:.3}),a=new g(i,n);a.position.y=.7,this.jukeboxGroup.add(a);const c=new me(.15,32),l=new x({color:0,roughness:.9,metalness:.1}),u=new g(c,l);u.position.set(-.3,.7,.31),u.rotation.y=Math.PI,this.jukeboxGroup.add(u);const h=new g(c,l);h.position.set(.3,.7,.31),h.rotation.y=Math.PI,this.jukeboxGroup.add(h);const f=new G(.8,.2,.1),p=new x({color:3355443,roughness:.5,metalness:.5}),m=new g(f,p);m.position.set(0,1.3,.31),this.jukeboxGroup.add(m);const b=new I(.03,.03,.02,16),w=new x({color:16711680,roughness:.3,metalness:.7}),D=new g(b,w);D.position.set(-.2,1.3,.36),D.rotation.x=Math.PI/2,this.jukeboxGroup.add(D);const S=new g(b,w);S.position.set(.2,1.3,.36),S.rotation.x=Math.PI/2,this.jukeboxGroup.add(S),this.jukeboxGroup.traverse(M=>{M instanceof g&&(M.castShadow=!0,M.receiveShadow=!0)})}setupAudio(){const e=new q,t=this.songs[this.currentSong];e.load(t,s=>{this.audio.setBuffer(s),this.audio.setVolume(.3),this.audio.setLoop(!0);const i=this.getCurrentSongTitle();document.dispatchEvent(new Y(i))},s=>{console.log(`${s.loaded/s.total*100}% loaded`)},s=>{console.error("Error loading audio:",s)})}getCurrentSongTitle(){return this.songTitles[this.currentSong]}setPosition(e){this.jukeboxGroup.position.copy(e)}togglePlay(){this.isMuted=!this.isMuted,this.isMuted?(this.lastVolume=this.audio.getVolume(),this.audio.setVolume(0)):this.audio.setVolume(this.lastVolume)}setVolume(e){this.audio.setVolume(e),e>0&&(this.lastVolume=e),this.isMuted=e===0}nextSong(){this.currentSong=(this.currentSong+1)%this.songs.length,this.audio.stop(),new q().load(this.songs[this.currentSong],t=>{if(this.audio.setBuffer(t),this.isPlaying){this.audio.play();const s=this.getCurrentSongTitle();document.dispatchEvent(new Y(s))}})}getPosition(){return this.jukeboxGroup.position.clone()}isNearby(e,t=3){return this.jukeboxGroup.position.distanceTo(e)<t}setAudioListener(e){e.add(this.audioListener)}getMutedState(){return this.isMuted}}class Ge{constructor(e){o(this,"mesh");o(this,"scene");this.scene=e,this.mesh=new F,this.createLighthouse()}createLighthouse(){const e=new I(1.5,2.25,15,8),t=new x({color:16777215,roughness:.7,metalness:.3}),s=new g(e,t);s.position.y=7.5,s.castShadow=!0,s.receiveShadow=!0,this.mesh.add(s);const i=new x({color:13369344,roughness:.7,metalness:.3});for(let M=0;M<3;M++){const T=new I(1.6,2.35,.75,8),j=new g(T,i);j.position.y=3.75+M*3.75,this.mesh.add(j)}const n=new I(3,3,2.25,8),a=new x({color:16777215,roughness:.7,metalness:.3}),c=new g(n,a);c.position.y=15,c.castShadow=!0,c.receiveShadow=!0,this.mesh.add(c);const l=new R(1.5,1.125),u=new x({color:8900331,roughness:.2,metalness:.8}),h=8,f=2.8;for(let M=0;M<h;M++){const T=new g(l,u),j=M/h*Math.PI*2+Math.PI/8;T.position.set(Math.cos(j)*f,15,Math.sin(j)*f),T.lookAt(0,15,0),T.rotateY(Math.PI),this.mesh.add(T)}const p=new te(3.75,3.25,8),m=new x({color:3355443,roughness:.8,metalness:.2}),b=new g(p,m);b.position.y=17.125,b.castShadow=!0,this.mesh.add(b);const w=new I(3.75,4.5,1.5,8),D=new x({color:8947848,roughness:.8,metalness:.2}),S=new g(w,D);S.position.y=.75,S.castShadow=!0,S.receiveShadow=!0,this.mesh.add(S),this.scene.add(this.mesh)}getMesh(){return this.mesh}setPosition(e,t,s){this.mesh.position.set(e,t,s)}dispose(){this.scene.remove(this.mesh),this.mesh.traverse(e=>{if(e instanceof g)if(e.geometry.dispose(),Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()})}}function Re(){const d=new fe(4210943,.8),e=new X(16777215,4.5);e.position.set(10,20,10),e.castShadow=!0,e.shadow.mapSize.width=4096,e.shadow.mapSize.height=4096,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-100,e.shadow.camera.right=100,e.shadow.camera.top=100,e.shadow.camera.bottom=-100,e.shadow.bias=-1e-4,e.shadow.normalBias=.01,e.shadow.radius=2,e.target.position.set(0,0,0),e.target.updateMatrixWorld();const t=new X(16777215,1.5);return t.position.copy(e.position),t.castShadow=!0,{ambientLight:d,directionalLight:e,shadowLight:t}}class Ke{constructor(){o(this,"ocean");o(this,"time",0);o(this,"uniforms");const e=new R(1e3,1e3,128,128);e.rotateX(-Math.PI/2),this.uniforms={time:{value:0},waveHeight:{value:.2},waveSpeed:{value:.8},waveLength:{value:8},noiseScale:{value:.05},noiseStrength:{value:.3},waterColor:{value:new A(8900331)},waterOpacity:{value:.2},maxDepth:{value:20}};const t=new C({uniforms:this.uniforms,vertexShader:`
        uniform float time;
        uniform float waveHeight;
        uniform float waveSpeed;
        uniform float waveLength;
        uniform float noiseScale;
        uniform float noiseStrength;
        
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying float vWaveHeight;
        varying float vDepth;
        varying vec2 vNoisePos;
        
        // Improved noise function
        float random(vec2 st) {
          return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
        }
        
        float noise(vec2 st) {
          vec2 i = floor(st);
          vec2 f = fract(st);
          
          float a = random(i);
          float b = random(i + vec2(1.0, 0.0));
          float c = random(i + vec2(0.0, 1.0));
          float d = random(i + vec2(1.0, 1.0));
          
          vec2 u = f * f * (3.0 - 2.0 * f);
          return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
        }
        
        float fbm(vec2 st) {
          float value = 0.0;
          float amplitude = 0.5;
          float frequency = 1.0;
          
          for (int i = 0; i < 4; i++) {
            value += amplitude * noise(st * frequency);
            st *= 2.0;
            amplitude *= 0.5;
            frequency *= 2.0;
          }
          return value;
        }
        
        void main() {
          vec3 pos = position;
          
          // Base wave pattern
          float wave1 = sin(pos.x / waveLength + time * waveSpeed) * 
                      cos(pos.z / waveLength + time * waveSpeed);
          
          float wave2 = sin(pos.x / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                      cos(pos.z / (waveLength * 0.5) + time * waveSpeed * 1.2);
          
          // Add noise-based waves
          vec2 noisePos = pos.xz * noiseScale;
          float noiseWave = fbm(noisePos + time * waveSpeed * 0.5);
          
          // Combine waves with noise
          float wave = (wave1 + wave2 * 0.5 + noiseWave * noiseStrength) * waveHeight;
          
          pos.y += wave;
          
          // Calculate normal with improved accuracy
          float dx1 = cos(pos.x / waveLength + time * waveSpeed) * 
                    cos(pos.z / waveLength + time * waveSpeed) * 
                    waveHeight / waveLength;
          float dz1 = sin(pos.x / waveLength + time * waveSpeed) * 
                    -sin(pos.z / waveLength + time * waveSpeed) * 
                    waveHeight / waveLength;
                    
          float dx2 = cos(pos.x / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    cos(pos.z / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    waveHeight / (waveLength * 0.5);
          float dz2 = sin(pos.x / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    -sin(pos.z / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    waveHeight / (waveLength * 0.5);
          
          // Add noise-based normal variation
          vec2 noisePos2 = pos.xz * noiseScale * 2.0;
          float noiseDx = fbm(noisePos2 + vec2(0.1, 0.0) + time * waveSpeed * 0.5);
          float noiseDz = fbm(noisePos2 + vec2(0.0, 0.1) + time * waveSpeed * 0.5);
          
          vec3 normal = normalize(vec3(
            -(dx1 + dx2 * 0.5 + noiseDx * noiseStrength),
            1.0,
            -(dz1 + dz2 * 0.5 + noiseDz * noiseStrength)
          ));
          
          vDepth = -pos.y;
          vNormal = normal;
          vPosition = pos;
          vWaveHeight = wave;
          vNoisePos = pos.xz * 0.1 + time * 0.2; // For foam noise
          
          gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
        }
      `,fragmentShader:`
        uniform float time;
        uniform vec3 waterColor;
        uniform float waterOpacity;
        uniform float maxDepth;
        
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying float vWaveHeight;
        varying float vDepth;
        varying vec2 vNoisePos;
        
        // Improved noise function
        float random(vec2 st) {
          return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
        }
        
        float noise(vec2 st) {
          vec2 i = floor(st);
          vec2 f = fract(st);
          
          float a = random(i);
          float b = random(i + vec2(1.0, 0.0));
          float c = random(i + vec2(0.0, 1.0));
          float d = random(i + vec2(1.0, 1.0));
          
          vec2 u = f * f * (3.0 - 2.0 * f);
          return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
        }
        
        float fbm(vec2 st) {
          float value = 0.0;
          float amplitude = 0.5;
          float frequency = 1.0;
          
          for (int i = 0; i < 4; i++) {
            value += amplitude * noise(st * frequency);
            st *= 2.0;
            amplitude *= 0.5;
            frequency *= 2.0;
          }
          return value;
        }
        
        void main() {
          // Calculate water color with depth
          float depthFactor = smoothstep(0.0, maxDepth, vDepth);
          vec3 color = mix(waterColor, waterColor * 0.7, depthFactor);
          
          // Calculate foam using multiple noise layers
          float foamNoise1 = fbm(vNoisePos);
          float foamNoise2 = fbm(vNoisePos * 2.0 + 10.0);
          float foamNoise3 = fbm(vNoisePos * 4.0 + 20.0);
          
          // Combine noise layers for more interesting foam pattern
          float foamPattern = (foamNoise1 * 0.5 + foamNoise2 * 0.3 + foamNoise3 * 0.2);
          
          // Wave peak foam
          float waveFoam = smoothstep(0.0, 0.2, vWaveHeight) * 
                          (1.0 - smoothstep(0.2, 0.4, vWaveHeight));
          
          // Shore foam
          float shoreDistance = length(vPosition.xz);
          float shoreFoam = smoothstep(45.0, 50.0, shoreDistance) * 
                          (1.0 - smoothstep(50.0, 55.0, shoreDistance));
          
          // Combine foam effects with noise
          float foamAmount = max(waveFoam, shoreFoam) * foamPattern;
          
          // Add foam to color
          color = mix(color, vec3(1.0), foamAmount);
          
          // Add specular highlights
          vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));
          float spec = pow(max(dot(reflect(-lightDir, vNormal), normalize(vPosition)), 0.0), 32.0);
          color += spec * 0.3;
          
          gl_FragColor = vec4(color, waterOpacity);
        }
      `,transparent:!0,depthWrite:!1,side:O});this.ocean=new g(e,t),this.ocean.position.y=0}update(e){this.time+=e,this.uniforms.time.value=this.time}getMesh(){return this.ocean}dispose(){this.ocean.geometry.dispose(),this.ocean.material instanceof C&&this.ocean.material.dispose()}}class Ve{constructor(e,t){o(this,"mesh");o(this,"lifetime");o(this,"currentTime");const s=new R(t,t),i=new x({color:12101784,transparent:!0,opacity:.2,roughness:.9});this.mesh=new g(s,i),this.mesh.rotation.x=-Math.PI/2,this.mesh.position.copy(e),this.mesh.position.y+=.01,this.lifetime=5,this.currentTime=0}update(e){this.currentTime+=e;const t=this.currentTime/this.lifetime;return this.mesh.material instanceof x&&(this.mesh.material.opacity=.8*(1-t)),t>=1}getMesh(){return this.mesh}}class We{constructor(e,t){o(this,"trails",[]);o(this,"scene");o(this,"terrain");o(this,"lastTrailPosition",null);o(this,"minDistance",.5);this.scene=e,this.terrain=t}update(e,t){const s=this.terrain.getHeightAt(t.x,t.z),i=new y(t.x,s,t.z);(!this.lastTrailPosition||this.lastTrailPosition.distanceTo(i)>=this.minDistance)&&(this.createTrail(i),this.lastTrailPosition=i.clone()),this.trails=this.trails.filter(n=>{const a=n.update(e);return a&&this.scene.remove(n.getMesh()),!a})}createTrail(e){const t=new Ve(e,.3);this.scene.add(t.getMesh()),this.trails.push(t)}dispose(){for(const e of this.trails)this.scene.remove(e.getMesh());this.trails=[]}}function Ue(){const e=new ie().load("/apps/beach/textures/autumn.jpeg");return e.mapping=pe,e}const H=class H{constructor(e,t,s,i){o(this,"mesh");o(this,"uniforms");o(this,"position");o(this,"size");o(this,"currentLOD");o(this,"geometries");o(this,"lastUpdateTime",0);o(this,"updateInterval",0);o(this,"baseHeight");this.position=e,this.size=t,this.currentLOD=0,this.baseHeight=i,this.geometries=H.LOD_LEVELS.map(a=>{const c=new R(t,t,a.resolution,a.resolution);c.rotateX(-Math.PI/2);const u=c.attributes.position.array,h=u.length/3;for(let f=0;f<h;f++){const p=u[f*3],m=u[f*3+2],b=p+e.x,w=m+e.y,D=Math.sqrt(b*b+w*w),S=40,M=.005,T=12,j=.4,W=new k(b,w).multiplyScalar(M);let E=this.fbm(W)*T*j;E+=Math.sin(b*.03)*Math.cos(w*.03)*.05;const P=45,L=-1.5,N=4,V=this.smoothstep(S,P,D),z=1-this.smoothstep(0,S*.7,D);E+=z*N,E=this.mix(E,L,V),u[f*3+1]=E+i}return c.computeVertexNormals(),c}),this.uniforms={time:{value:0},sandColor:{value:new A(16044095)},sandColor2:{value:new A(15844367)},sandColor3:{value:new A(15965202)},sandColor4:{value:new A(15105570)},sandTexture:{value:s},lightDirection:{value:new y(1,1,1)},fogColor:{value:new A(8900331)},fogDensity:{value:.01}};const n=new C({uniforms:this.uniforms,vertexShader:`
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;
        varying float vFogDepth;
        
        void main() {
          vNormal = normal;
          vPosition = position;
          vUv = uv * 10.1;
          
          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
          vFogDepth = -mvPosition.z;
          
          gl_Position = projectionMatrix * mvPosition;
        }
      `,fragmentShader:`
        uniform sampler2D sandTexture;
        uniform vec3 lightDirection;
        uniform vec3 fogColor;
        uniform float fogDensity;
        
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;
        varying float vFogDepth;
        
        void main() {
          vec4 sandColor = texture2D(sandTexture, vUv);
          
          // Enhanced lighting
          float diffuse = max(0.0, dot(vNormal, normalize(lightDirection)));
          vec3 color = sandColor.rgb * (diffuse * 0.8 + 0.5);
          
          // Add some specular highlights
          vec3 viewDir = normalize(-vPosition);
          vec3 reflectDir = reflect(-normalize(lightDirection), vNormal);
          float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.0);
          color += spec * 0.15;
          
          // Apply fog
          float fogFactor = 1.0 - exp(-fogDensity * fogDensity * vFogDepth * vFogDepth);
          color = mix(color, fogColor, fogFactor);
          
          gl_FragColor = vec4(color, 1.0);
        }
      `});this.mesh=new g(this.geometries[0],n),this.mesh.position.set(e.x,0,e.y),this.mesh.receiveShadow=!0,this.mesh.castShadow=!1,this.mesh.customDepthMaterial=void 0}updateLOD(e){const t=new k(e.x-this.position.x,e.z-this.position.y).length();let s=0;for(let i=0;i<H.LOD_LEVELS.length&&t>=H.LOD_LEVELS[i].distance;i++)s=i;s!==this.currentLOD&&(this.mesh.geometry=this.geometries[s],this.currentLOD=s),this.updateInterval=Math.max(.1,t*.01)}shouldUpdate(e){return e-this.lastUpdateTime>=this.updateInterval}update(e,t){this.shouldUpdate(t)&&(this.uniforms.time.value+=e,this.lastUpdateTime=t)}getMesh(){return this.mesh}getPosition(){return this.position}getSize(){return this.size}updateUniforms(e,t,s){this.uniforms.lightDirection.value=e,this.uniforms.fogColor.value=t,this.uniforms.fogDensity.value=s}dispose(){for(const e of this.geometries)e.dispose();this.mesh.material instanceof C&&this.mesh.material.dispose()}fbm(e){let t=0,s=.5,i=1;for(let n=0;n<4;n++)t+=s*this.noise(e.clone().multiplyScalar(i)),e.multiplyScalar(2),s*=.5,i*=2;return t}noise(e){const t=new k(Math.floor(e.x),Math.floor(e.y)),s=new k(e.x-t.x,e.y-t.y),i=this.random(t),n=this.random(new k(t.x+1,t.y)),a=this.random(new k(t.x,t.y+1)),c=this.random(new k(t.x+1,t.y+1)),l=new k(s.x*s.x*(3-2*s.x),s.y*s.y*(3-2*s.y));return this.mix(this.mix(i,n,l.x),this.mix(a,c,l.x),l.y)}random(e){return Math.sin(e.dot(new k(12.9898,78.233)))*43758.5453123%1}mix(e,t,s){return e*(1-s)+t*s}smoothstep(e,t,s){const i=Math.max(0,Math.min(1,(s-e)/(t-e)));return i*i*(3-2*i)}};o(H,"LOD_LEVELS",[{resolution:64,distance:0},{resolution:32,distance:24}]);let B=H;class Be{constructor(e,t,s=0){o(this,"chunks");o(this,"scene");o(this,"camera");o(this,"sandTexture");o(this,"chunkSize");o(this,"viewDistance");o(this,"loadedChunks");o(this,"frustum");o(this,"projScreenMatrix");o(this,"updateQueue",[]);o(this,"MAX_UPDATES_PER_FRAME",4);o(this,"lastChunkUpdateTime",0);o(this,"CHUNK_UPDATE_INTERVAL",.1);o(this,"baseHeight");o(this,"isWireframeMode",!1);this.chunks=new Map,this.scene=e,this.camera=t,this.chunkSize=32,this.viewDistance=96,this.loadedChunks=new Set,this.frustum=new ge,this.projScreenMatrix=new we,this.baseHeight=s;const i=new ie;this.sandTexture=i.load("/apps/beach/textures/sand.jpg"),this.sandTexture.wrapS=$,this.sandTexture.wrapT=$,this.sandTexture.repeat.set(20,20),this.sandTexture.minFilter=Q,this.sandTexture.magFilter=Q,this.sandTexture.generateMipmaps=!1,this.updateChunks()}update(e){const t=performance.now()/1e3;t-this.lastChunkUpdateTime>=this.CHUNK_UPDATE_INTERVAL&&(this.projScreenMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.frustum.setFromProjectionMatrix(this.projScreenMatrix),this.updateChunks(),this.lastChunkUpdateTime=t),this.updateQueue=Array.from(this.chunks.values()).filter(i=>this.isChunkVisible(i)).sort((i,n)=>{const a=new k(this.camera.position.x-i.getPosition().x,this.camera.position.z-i.getPosition().y).length(),c=new k(this.camera.position.x-n.getPosition().x,this.camera.position.z-n.getPosition().y).length();return a-c});for(const i of this.updateQueue)i.updateLOD(this.camera.position);const s=Math.min(this.MAX_UPDATES_PER_FRAME,this.updateQueue.length);for(let i=0;i<s;i++)this.updateQueue[i].update(e,t)}updateChunks(){const e=new k(this.camera.position.x,this.camera.position.z),t=Math.floor((e.x-this.viewDistance)/this.chunkSize),s=Math.ceil((e.x+this.viewDistance)/this.chunkSize),i=Math.floor((e.y-this.viewDistance)/this.chunkSize),n=Math.ceil((e.y+this.viewDistance)/this.chunkSize);for(let a=t;a<=s;a++)for(let c=i;c<=n;c++){const l=`${a},${c}`,u=new k(a*this.chunkSize,c*this.chunkSize);if(!this.chunks.has(l)){const h=new B(u,this.chunkSize,this.sandTexture,this.baseHeight);this.chunks.set(l,h),this.scene.add(h.getMesh())}}for(const[a,c]of this.chunks.entries())e.distanceTo(c.getPosition())>this.viewDistance*1.5&&(this.scene.remove(c.getMesh()),c.dispose(),this.chunks.delete(a))}isChunkVisible(e){const t=new ve,s=e.getSize(),i=e.getPosition();return t.setFromCenterAndSize(new y(i.x,0,i.y),new y(s,20,s)),this.frustum.intersectsBox(t)}getHeightAt(e,t){const s=Math.floor(e/this.chunkSize),i=Math.floor(t/this.chunkSize),n=`${s},${i}`;if(!this.chunks.get(n))return this.baseHeight;const c=.005,l=12,u=.4,h=Math.sqrt(e*e+t*t),f=40,p=new k(e,t).multiplyScalar(c);let m=this.fbm(p)*l*u;m+=Math.sin(e*.03)*Math.cos(t*.03)*.05;const b=45,w=-1.5,D=4,S=this.smoothstep(f,b,h),M=1-this.smoothstep(0,f*.7,h);return m+=M*D,m=this.mix(m,w,S),m+this.baseHeight}getNormalAt(e,t){const i=this.getHeightAt(e-.1,t),n=this.getHeightAt(e+.1,t),a=this.getHeightAt(e,t-.1),c=this.getHeightAt(e,t+.1);return new y(i-n,2*.1,a-c).normalize()}fbm(e){let t=0,s=.5,i=1;for(let n=0;n<4;n++)t+=s*this.noise(e.clone().multiplyScalar(i)),e.multiplyScalar(2),s*=.5,i*=2;return t}noise(e){const t=new k(Math.floor(e.x),Math.floor(e.y)),s=new k(e.x-t.x,e.y-t.y),i=this.random(t),n=this.random(new k(t.x+1,t.y)),a=this.random(new k(t.x,t.y+1)),c=this.random(new k(t.x+1,t.y+1)),l=new k(s.x*s.x*(3-2*s.x),s.y*s.y*(3-2*s.y));return this.mix(this.mix(i,n,l.x),this.mix(a,c,l.x),l.y)}random(e){return Math.sin(e.dot(new k(12.9898,78.233)))*43758.5453123%1}mix(e,t,s){return e*(1-s)+t*s}smoothstep(e,t,s){const i=Math.max(0,Math.min(1,(s-e)/(t-e)));return i*i*(3-2*i)}updateUniforms(e,t,s){for(const i of this.chunks.values())i.updateUniforms(e,t,s)}dispose(){for(const e of this.chunks.values())this.scene.remove(e.getMesh()),e.dispose();this.chunks.clear(),this.sandTexture.dispose()}setWireframeMode(e){this.isWireframeMode=e;for(const t of this.chunks.values()){const s=t.getMesh().material;if(s instanceof x||s instanceof C)s.wireframe=e;else if(Array.isArray(s))for(const i of s)(i instanceof x||i instanceof C)&&(i.wireframe=e)}}getChunkSize(){return this.chunkSize}getViewDistance(){return this.viewDistance}}class Oe{constructor(){o(this,"scene");o(this,"camera");o(this,"renderer");o(this,"clock");o(this,"terrain");o(this,"controller");o(this,"sandTrailManager");o(this,"ocean");o(this,"lighthouse");o(this,"clouds");o(this,"ambientLight");o(this,"directionalLight");o(this,"shadowLight");o(this,"timeOfDay",12);o(this,"isWireframeMode",!1);o(this,"animationFrameId",null);o(this,"TERRAIN_BASE_HEIGHT",1);o(this,"beachFurniture");o(this,"jukebox");o(this,"otherPlayers",new Map);o(this,"playerNameToTexture",{});o(this,"animate",()=>{this.animationFrameId=requestAnimationFrame(this.animate);const e=this.clock.getDelta();if(this.controller.update(e),this.sandTrailManager&&this.controller){const t=this.controller.getPosition();t&&this.sandTrailManager.update(e,t)}if(this.ocean.update(e),this.clouds.update(e),this.terrain.update(e),this.otherPlayers&&this.otherPlayers.size>0){for(const[t,s]of this.otherPlayers)if(s.userData.targetPosition&&s.userData.targetQuaternion){s.position.lerp(s.userData.targetPosition,.1),s.quaternion.slerp(s.userData.targetQuaternion,.1);const i=s.getObjectByName("nicknameSprite");i&&i.position.copy(s.position).add(new y(0,1,0))}}this.renderer.render(this.scene,this.camera)});this.scene=new ye,this.scene.background=Ue(),this.scene.environment=this.scene.background,this.scene.fog=new K(8900331,.01),this.camera=new xe(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,1.7,0);const e=document.getElementById("scene-canvas");this.renderer=new be({canvas:e,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=ke,this.renderer.shadowMap.autoUpdate=!0,this.clock=new Me,this.initScene(),this.controller=new Ie(this.camera,this.scene,this.terrain,this,this.jukebox),this.controller.loadPosition(),this.sandTrailManager=new We(this.scene,this.terrain),this.ocean=new Ke,this.scene.add(this.ocean.getMesh()),this.animate(),this.setupPositionSaving()}getPlayerTransform(){if(!this.controller)return null;const e=this.controller.getPosition(),t=this.controller.getRotationY();return!e||typeof t!="number"?null:{x:e.x,y:e.y,z:e.z,rotationY:t}}updateRemotePlayerVisuals(e,t){const s=new Set(Object.keys(e));for(const i in e){const n=e[i];if(!n)continue;let a=this.otherPlayers.get(i),c=this.playerNameToTexture[i];if(a){const l=t[i]||i.substring(0,6),u=a.getObjectByName("nicknameSprite");if(u&&c&&u.userData.currentNickname!==l){const h=c.image.getContext("2d");h&&(h.clearRect(0,0,c.image.width,c.image.height),h.font="bold 24px Arial",h.fillStyle="rgba(255, 255, 255, 0.9)",h.textAlign="center",h.textBaseline="middle",h.fillText(l,c.image.width/2,c.image.height/2),c.needsUpdate=!0,u.userData.currentNickname=l)}}else{const l=new Se(.4,.8,4,8),u=i.split("").reduce((D,S)=>D+S.charCodeAt(0),0),h=new A(Math.sin(u*.123+.5)*.4+.3,Math.sin(u*.234+1)*.4+.3,Math.sin(u*.345+1.5)*.4+.3),f=new x({color:h,roughness:.7,metalness:.1});a=new g(l,f),a.castShadow=!0,a.receiveShadow=!0;const p=document.createElement("canvas");p.width=256,p.height=64;const m=p.getContext("2d");m&&(m.font="bold 24px Arial",m.fillStyle="rgba(255, 255, 255, 0.9)",m.textAlign="center",m.textBaseline="middle",m.fillText(t[i]||i.substring(0,6),p.width/2,p.height/2)),c=new Pe(p),c.needsUpdate=!0,this.playerNameToTexture[i]=c;const b=new Le({map:c,transparent:!0,alphaTest:.1}),w=new J(b);w.position.set(0,1,0),w.scale.set(1.5,.375,1),w.name="nicknameSprite",a.add(w),this.scene.add(a),this.otherPlayers.set(i,a)}a.userData.targetPosition=new y(n.x,n.y,n.z),a.userData.targetQuaternion=new De().setFromEuler(new se(0,n.rotationY,0,"YXZ"))}for(const[i,n]of this.otherPlayers)if(!s.has(i)){if(this.scene.remove(n),n.geometry&&n.geometry.dispose(),n.material instanceof Ne)n.material.dispose();else if(Array.isArray(n.material))for(const l of n.material)l.dispose();const a=n.children.find(l=>l instanceof J);if(a){const l=a.material;l.map&&l.map.dispose(),l.dispose()}this.otherPlayers.delete(i);const c=this.playerNameToTexture[i];c&&(c.dispose(),delete this.playerNameToTexture[i])}}initScene(){const{ambientLight:e,directionalLight:t,shadowLight:s}=Re();this.ambientLight=e,this.directionalLight=t,this.shadowLight=s,this.scene.add(this.ambientLight,this.directionalLight,this.shadowLight),this.terrain=new Be(this.scene,this.camera,this.TERRAIN_BASE_HEIGHT),this.lighthouse=new Ge(this.scene),this.clouds=new ze,this.scene.add(this.clouds.getCloudGroup()),this.beachFurniture=new Fe(this.scene,this.terrain),this.jukebox=new He(this.scene,this.terrain),this.jukebox.setAudioListener(this.camera),this.scene.fog&&this.terrain.updateUniforms(this.directionalLight.position,this.scene.fog.color,this.scene.fog instanceof K?this.scene.fog.density:.01)}toggleWireframeMode(){this.isWireframeMode=!this.isWireframeMode,this.scene.traverse(e=>{if(e instanceof g)if(Array.isArray(e.material))for(const t of e.material)(t instanceof x||t instanceof Z||t instanceof C)&&(t.wireframe=this.isWireframeMode);else(e.material instanceof x||e.material instanceof Z||e.material instanceof C)&&(e.material.wireframe=this.isWireframeMode)}),this.terrain&&typeof this.terrain.setWireframeMode=="function"&&this.terrain.setWireframeMode(this.isWireframeMode)}setTimeOfDay(e){this.timeOfDay=Math.max(0,Math.min(24,e));const t=(this.timeOfDay-6)/12*Math.PI*2;this.directionalLight.position.set(Math.cos(t)*100,Math.sin(t)*100,50),this.shadowLight.position.copy(this.directionalLight.position),this.timeOfDay<5||this.timeOfDay>19?(this.ambientLight.intensity=.1,this.directionalLight.intensity=.05,this.scene.fog&&this.scene.fog.color.set(51)):this.timeOfDay<7||this.timeOfDay>17?(this.ambientLight.intensity=.3,this.directionalLight.intensity=.5,this.directionalLight.color.set(16755285),this.scene.fog&&this.scene.fog.color.set(16768426)):(this.ambientLight.intensity=.5,this.directionalLight.intensity=1,this.directionalLight.color.set(16777215),this.scene.fog&&this.scene.fog.color.set(8900331)),this.terrain&&this.scene.fog&&this.terrain.updateUniforms(this.directionalLight.position,this.scene.fog.color,this.scene.fog instanceof K?this.scene.fog.density:.01)}setFogDensity(e){this.scene.fog instanceof K&&(this.scene.fog.density=e),this.terrain&&this.scene.fog&&this.terrain.updateUniforms(this.directionalLight.position,this.scene.fog.color,this.scene.fog instanceof K?this.scene.fog.density:.01)}getJukebox(){return this.jukebox}getWorldDimensions(){if(this.terrain){const e=this.terrain.getChunkSize(),s=(2*this.terrain.getViewDistance()+1)*e;return{width:s,depth:s,heightScale:50}}return console.warn("SceneManager.getWorldDimensions(): Terrain not available, using default."),{width:500,depth:500,heightScale:50}}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}resetCamera(){this.controller.resetPosition()}dispose(){var e,t,s,i,n,a,c,l,u;this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId),this.scene.traverse(h=>{if(h instanceof g&&(h.geometry&&h.geometry.dispose(),h.material))if(Array.isArray(h.material))for(const f of h.material)f.dispose();else h.material.dispose()}),this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.environment&&this.scene.environment.dispose&&this.scene.environment.dispose(),(e=this.terrain)==null||e.dispose(),(t=this.ocean)==null||t.dispose(),(s=this.lighthouse)==null||s.dispose(),(i=this.beachFurniture)==null||i.dispose(),(n=this.jukebox)==null||n.dispose(),(a=this.sandTrailManager)==null||a.dispose(),(c=this.controller)==null||c.dispose();for(const h of this.otherPlayers.values()){const f=h.getObjectByName("nicknameSprite");(l=f==null?void 0:f.material)!=null&&l.map&&f.material.map.dispose(),(u=f==null?void 0:f.material)==null||u.dispose()}this.otherPlayers.clear();for(const h of Object.values(this.playerNameToTexture))h.dispose();this.playerNameToTexture={},this.renderer.dispose()}setupPositionSaving(){setInterval(()=>{this.controller.savePosition()},5e3)}}const _e=({onChange:d})=>r.jsx("div",{className:"bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10",children:r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsx("label",{htmlFor:"fog-density-slider",className:"text-white text-sm font-medium tracking-wider uppercase",children:"Fog Density"}),r.jsx("input",{id:"fog-density-slider",type:"range",min:"0",max:"0.1",step:"0.001",defaultValue:"0.01",onChange:e=>d(Number.parseFloat(e.target.value)),className:"w-32 h-2 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-gradient-to-r [&::-webkit-slider-thumb]:from-blue-400 [&::-webkit-slider-thumb]:to-purple-400 [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-white/20 [&::-webkit-slider-thumb]:shadow-lg"})]})}),qe=({onChange:d})=>r.jsx("div",{className:"bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10",children:r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsx("label",{htmlFor:"volume-slider",className:"text-white text-sm font-medium tracking-wider uppercase",children:"Music Volume"}),r.jsx("input",{id:"volume-slider",type:"range",min:"0",max:"1",step:"0.01",defaultValue:"0.3",onChange:e=>d(Number.parseFloat(e.target.value)),className:"w-32 h-2 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-gradient-to-r [&::-webkit-slider-thumb]:from-blue-400 [&::-webkit-slider-thumb]:to-purple-400 [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-white/20 [&::-webkit-slider-thumb]:shadow-lg"})]})}),Xe=()=>{const[d,e]=v.useState(0),t=v.useRef(0),s=v.useRef(performance.now()),i=v.useRef();return v.useEffect(()=>{const n=()=>{const a=performance.now();t.current++,a-s.current>=1e3&&(e(Math.round(t.current*1e3/(a-s.current))),t.current=0,s.current=a),i.current=requestAnimationFrame(n)};return i.current=requestAnimationFrame(n),()=>{i.current&&cancelAnimationFrame(i.current)}},[]),r.jsxs("div",{className:"absolute top-4 left-4 text-white bg-black/50 px-3 py-1 rounded text-sm",children:["FPS: ",d]})},$e=()=>{const d=new Date("2025-06-16T22:20:03.766Z"),t=Math.floor((new Date().getTime()-d.getTime())/(1e3*60*60*24)),s=d.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return r.jsxs("div",{className:"bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10 text-white text-sm font-medium tracking-wider",children:["Build: ",s," (",t," days ago)"]})},Qe=({title:d,isVisible:e,isMuted:t})=>{const[s,i]=v.useState(0),[n,a]=v.useState(.9);return v.useEffect(()=>{if(e){const c=setTimeout(()=>{i(1),a(1)},100),l=setTimeout(()=>{i(0),a(.9)},3e3);return()=>{clearTimeout(c),clearTimeout(l)}}},[e]),r.jsx("div",{className:"fixed bottom-24 left-1/2 transform -translate-x-1/2 z-30",children:r.jsx("div",{className:"bg-gradient-to-r from-black/90 to-black/70 backdrop-blur-xl px-8 py-4 rounded-2xl shadow-2xl border border-white/10 transition-all duration-500 ease-out",style:{opacity:s,transform:`scale(${n}) translateY(${e?0:20}px)`},children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-white text-xl font-bold mb-2 tracking-wide",children:"Now Playing"}),r.jsx("div",{className:"text-blue-300 text-lg font-medium mb-4",children:d}),r.jsxs("div",{className:"text-sm text-gray-300/80 flex items-center justify-center gap-3",children:[r.jsxs("span",{className:"flex items-center",children:[r.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),t?"Press P to unmute":"Press P to mute"]}),r.jsx("span",{className:"text-gray-500",children:"•"}),r.jsxs("span",{className:"flex items-center",children:[r.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full mr-2"}),"Press N to skip"]})]})]})})})},Je={width:500,depth:500},Ze={width:150,height:150},Ye=({allPlayerPositions:d,myId:e,allNicknames:t,worldSize:s=Je,minimapSize:i=Ze})=>{const n=(a,c)=>{const l=a/s.width+.5,u=c/s.depth+.5;return{left:`${Math.max(0,Math.min(1,l))*100}%`,top:`${Math.max(0,Math.min(1,u))*100}%`}};return r.jsx("div",{className:"absolute top-4 left-4 bg-black/70 backdrop-blur-sm border border-white/20 rounded-lg shadow-xl overflow-hidden",style:{width:`${i.width}px`,height:`${i.height}px`},children:Object.entries(d).map(([a,c])=>{if(!c)return null;const{left:l,top:u}=n(c.x,c.z),h=a===e,f=t[a]||a.substring(0,6),p=h?"bg-blue-400":"bg-red-400";return r.jsx("div",{className:`absolute w-3 h-3 ${p} rounded-full transform -translate-x-1/2 -translate-y-1/2 shadow-md`,style:{left:l,top:u},title:`${f} (X: ${c.x.toFixed(0)}, Z: ${c.z.toFixed(0)})`,children:h&&r.jsx("div",{className:"w-full h-full rounded-full border-2 border-white animate-ping-slow opacity-75"})},a)})})},et=({isOpen:d,onClose:e})=>{const t=v.useRef(null),s=v.useRef(null),i=v.useRef(null),n=oe(),[a]=ne(),{messages:c,sendMessage:l}=Te("beach-chat"),[u,h]=v.useState(""),f=v.useRef(!1);v.useEffect(()=>{d&&(f.current=!0)},[d]),v.useEffect(()=>{f.current&&t.current&&d&&(t.current.scrollIntoView({behavior:"smooth"}),f.current=!1)}),v.useEffect(()=>{d&&t.current&&t.current.scrollIntoView({behavior:"smooth"})},[d]),v.useEffect(()=>{d&&s.current&&setTimeout(()=>{var m;(m=s.current)==null||m.focus()},100)},[d]),v.useEffect(()=>{if(!d)return;const m=w=>{["KeyW","KeyA","KeyS","KeyD","Space","KeyN","KeyP","KeyT","KeyF"].includes(w.code)&&w.stopPropagation(),w.code==="Escape"&&(w.stopPropagation(),w.preventDefault(),e())},b=w=>{i.current&&!i.current.contains(w.target)&&e()};return window.addEventListener("keydown",m,!0),document.addEventListener("mousedown",b),()=>{window.removeEventListener("keydown",m,!0),document.removeEventListener("mousedown",b)}},[d,e]);const p=m=>{if(m.preventDefault(),u.trim()!=="")try{n?(l(u),h(""),f.current=!0):(console.log("Cannot send message outside of a session"),h(""))}catch(b){console.error("Failed to send message:",b)}};return d?r.jsxs("div",{ref:i,className:"fixed bottom-4 right-4 w-80 h-96 bg-black/70 backdrop-blur-sm rounded-xl shadow-2xl border border-white/10 flex flex-col overflow-hidden z-50",children:[r.jsxs("div",{className:"px-4 py-3 bg-black/30 border-b border-white/10 flex justify-between items-center",children:[r.jsx("h3",{className:"text-white font-bold",children:"Beach Chat"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"text-xs text-white/70 mr-2",children:"ESC to close"}),r.jsx("button",{type:"button",onClick:m=>{m.stopPropagation(),e()},className:"text-white/70 hover:text-white",children:r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-labelledby":"close-title",children:[r.jsx("title",{id:"close-title",children:"Close"}),r.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})]})})]})]}),r.jsxs("div",{className:"flex-1 p-4 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-transparent",children:[n?c.length===0?r.jsx("div",{className:"text-white/50 text-center mt-4",children:"No messages yet. Start the conversation!"}):c.map(m=>r.jsx("div",{className:`mb-3 ${m.senderId===a?"text-right":"text-left"}`,children:r.jsxs("div",{className:`inline-block px-3 py-2 rounded-lg ${m.senderId===a?"bg-blue-500/70 text-white":"bg-white/10 text-white"}`,children:[m.senderId!==a&&r.jsx("div",{className:"text-xs text-blue-300 mb-1 font-medium",children:m.senderId}),r.jsx("div",{children:m.message}),r.jsx("div",{className:"text-xs opacity-50 mt-1",children:new Date(m.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},m.id)):r.jsx("div",{className:"text-red-300 text-center mt-4 p-3 bg-red-500/20 rounded-lg",children:"You're not connected to a multiplayer session. Chat is unavailable."}),r.jsx("div",{ref:t})]}),r.jsx("form",{onSubmit:p,className:"p-3 border-t border-white/10 bg-black/20",children:r.jsxs("div",{className:"flex",children:[r.jsx("input",{ref:s,type:"text",value:u,onChange:m=>h(m.target.value),placeholder:n?"Type a message...":"Chat unavailable in single player",className:"flex-1 bg-white/10 text-white border border-white/20 rounded-l-lg px-3 py-2 outline-none focus:ring-1 focus:ring-blue-500",disabled:!n,onKeyDown:m=>{["KeyW","KeyA","KeyS","KeyD","Space","KeyN","KeyP","KeyT","KeyF"].includes(m.code)&&m.stopPropagation(),(m.key==="Tab"||m.key==="Escape")&&(m.preventDefault(),m.key==="Escape"&&e())}}),r.jsx("button",{type:"submit",disabled:!n,className:`${n?"bg-blue-500 hover:bg-blue-600":"bg-blue-500/50 cursor-not-allowed"} text-white px-4 rounded-r-lg transition-colors`,children:r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-labelledby":"send-title",children:[r.jsx("title",{id:"send-title",children:"Send"}),r.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})]})})]})})]}):null};function tt(){var E;const d=v.useRef(null),[e,t]=v.useState(!0),[s,i]=v.useState(""),[n,a]=v.useState(!1),[c,l]=v.useState(!1),[u,h]=v.useState(!1),f=je(),p=oe(),[m,b,w]=ne(),[D,S,M]=Ee("player-positions",null,{throttleDelay:50});v.useEffect(()=>{console.log("App.tsx render state:",{isGuiVisible:e,isTogether:p,myId:f,isChatOpen:u,allNicknamesCount:Object.keys(w||{}).length,allPlayerPositionsCount:Object.keys(M||{}).length});const P=new Oe;d.current=P;const L=()=>{P.onWindowResize()},N=z=>{var U,_;if(!u&&!(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement))switch(z.key){case"/":p&&(z.preventDefault(),h(!0));break;case"c":case"C":p&&h(!0);break;case"h":case"H":t(ae=>!ae);break;case"p":case"P":(_=(U=d.current)==null?void 0:U.getJukebox())==null||_.togglePlay();break}},V=z=>{i(z.songTitle),a(!0)};return window.addEventListener("resize",L),window.addEventListener("keydown",N),document.addEventListener("songchange",V),()=>{window.removeEventListener("resize",L),window.removeEventListener("keydown",N),document.removeEventListener("songchange",V),P.dispose()}},[p]),v.useEffect(()=>{if(!d.current||!S)return;const P=setInterval(()=>{var N;const L=(N=d.current)==null?void 0:N.getPlayerTransform();L&&S(L)},100);return()=>clearInterval(P)},[S]),v.useEffect(()=>{if(!d.current||!f)return;const P={};for(const[L,N]of Object.entries(M))L!==f&&N&&(P[L]=N);d.current.updateRemotePlayerVisuals(P,w)},[M,f,w]);const T=()=>{var P;(P=d.current)==null||P.resetCamera()},j=P=>{var L;(L=d.current)==null||L.setFogDensity(P)},W=P=>{var N;const L=(N=d.current)==null?void 0:N.getJukebox();L&&(L.setVolume(P),l(L.getMutedState()))};return r.jsxs("div",{className:"fixed inset-0 bg-black",children:[r.jsx("canvas",{id:"scene-canvas",className:"w-full h-full block"}),e&&r.jsx(Xe,{}),e&&p&&f&&r.jsx(Ye,{allPlayerPositions:M,myId:f,allNicknames:w,worldSize:((E=d.current)==null?void 0:E.getWorldDimensions())??void 0}),e&&p&&r.jsx(et,{isOpen:u,onClose:()=>h(!1)}),e&&r.jsx("div",{className:"absolute bottom-4 left-4 text-white bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10 max-w-xs z-0",children:r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),r.jsx("span",{children:"Use WASD to move, mouse to look around"})]}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),r.jsx("span",{children:"SPACE to jump, F to toggle fly mode"})]}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"w-2 h-2 bg-pink-400 rounded-full"}),r.jsx("span",{children:"T to toggle wireframe mode, H to toggle GUI"})]}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full"}),r.jsx("span",{children:"Press P to mute/unmute music and N to skip songs"})]}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),r.jsx("span",{children:"Press ESC to unlock the mouse"})]}),p&&!u&&r.jsxs("div",{className:"flex items-center gap-2 mb-2 text-cyan-300",children:[r.jsx("span",{className:"w-2 h-2 bg-cyan-400 rounded-full"}),r.jsx("span",{children:"Press '/' to open chat"})]}),window.innerWidth>640&&r.jsxs("div",{className:"flex items-center gap-2 mt-2 text-gray-300",children:[r.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),r.jsx("span",{children:"Q/E for up/down in fly mode"})]})]})}),e&&r.jsxs("div",{className:"absolute top-4 right-4 flex flex-col items-stretch gap-3 p-3 bg-black/50 backdrop-blur-md rounded-xl shadow-2xl border border-white/10 z-20 w-64",children:[r.jsx($e,{}),r.jsx("button",{onClick:T,type:"button",className:"w-full bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm hover:from-black/80 hover:to-black/60 text-white px-4 py-2.5 rounded-lg shadow-xl border border-white/10 transition-all duration-300 text-sm font-medium",children:"Reset Position"}),r.jsx(_e,{onChange:j}),r.jsx(qe,{onChange:W})]}),e&&r.jsx(Qe,{title:s,isVisible:n,isMuted:c})]})}console.log("VITE_RT_APP_ID:",void 0);console.log("VITE_MULTISYNQ_API_KEY:","2gseQMIyS1heIRWhVyKNXyGH7j1WARH02cobPAmjq9");const ee=document.getElementById("root"),st={appId:"beachtest1.local.thing",apiKey:"2gseQMIyS1heIRWhVyKNXyGH7j1WARH02cobPAmjq9",name:"vibe-beach-default-lobby",password:"lobbypassword"};if(ee)Ce.createRoot(ee).render(r.jsx(v.StrictMode,{children:r.jsx(Ae,{sessionParams:st,children:r.jsx(tt,{})})}));else throw new Error("Root element with id 'root' not found.");
