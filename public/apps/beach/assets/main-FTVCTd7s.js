var re=Object.defineProperty;var ce=(h,e,t)=>e in h?re(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var o=(h,e,t)=>ce(h,typeof e!="symbol"?e+"":e,t);import{G as F,s as le,M as x,a as g,B as G,V as S,P as R,C as I,D as O,b as te,S as he,E as se,A as de,c as ue,d as me,e as q,f as fe,g as X,h as A,i as C,T as ie,j as pe,F as ge,k as we,R as Q,N as $,l as b,m as ve,n as xe,o as V,p as ye,W as be,q as ke,r as Me,t as Se,u as Pe,v as Le,w as J,Q as De,x as Ne,y as Z,z as n,H as v,I as oe,O as ne,J as je,K as Te,L as Ee,U as Ce,X as Ae}from"./vendor-B54fIOLJ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();class Fe{constructor(e,t){o(this,"scene");o(this,"terrain");o(this,"furnitureGroup");o(this,"rng");this.scene=e,this.terrain=t,this.furnitureGroup=new F,this.scene.add(this.furnitureGroup),this.rng=le("beach-furniture-42")}createBeachChair(e,t=0){const s=new F,i=new x({color:9127187,roughness:.8,metalness:.2}),a=new g(new G(1.2,.1,.8),i);a.position.y=.3,s.add(a);const r=new g(new G(1.2,.1,.8),i);r.position.set(0,.7,-.7),r.rotation.x=Math.PI/4,s.add(r);const c=new G(.05,.3,.05);[new S(-.5,.15,.3),new S(.5,.15,.3),new S(-.5,.15,-.3),new S(.5,.15,-.3)].forEach(p=>{const m=new g(c,i);m.position.copy(p),s.add(m)});const u=new x({color:2003199,roughness:.9,metalness:.1}),l=new g(new R(1.1,.7),u);l.position.set(0,.38,0),l.rotation.x=-Math.PI/2,s.add(l);const f=new g(new R(1.1,.7),u);f.position.set(0,.7,-.6),f.rotation.x=-Math.PI/4,s.add(f),s.position.copy(e),s.rotation.y=t,s.castShadow=!0,s.receiveShadow=!0,this.furnitureGroup.add(s)}createUmbrella(e,t=0){const s=new F,i=new x({color:9127187,roughness:.8,metalness:.2}),a=new g(new I(.05,.05,2.5,8),i);a.position.y=1.25,s.add(a);const r=new x({color:16711680,roughness:.9,metalness:.1,side:O}),c=new te(1.2,1,8),d=new g(c,r);d.position.y=2.5,d.rotation.x=0,s.add(d),s.position.copy(e),s.rotation.y=t,s.castShadow=!0,s.receiveShadow=!0;const u=this.rng()*.5+.3,l=this.rng()*Math.PI*2,f=Math.cos(l)*u,p=Math.sin(l)*u;s.position.x+=f,s.position.z+=p,this.furnitureGroup.add(s)}dispose(){this.scene.remove(this.furnitureGroup),this.furnitureGroup.traverse(e=>{e instanceof g&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())})}}class ze{constructor(){o(this,"cloudGroup");o(this,"clouds",[]);o(this,"windDirection");o(this,"windSpeed");this.cloudGroup=new F,this.windDirection=new S(1,0,0).normalize(),this.windSpeed=.1,this.createClouds()}createClouds(){for(let a=0;a<15;a++){const r=new F,c=Math.floor(Math.random()*3)+3;for(let d=0;d<c;d++){const u=5*(.5+Math.random()*.5),l=new he(u,8,8),f=new x({color:16777215,transparent:!0,opacity:.8,roughness:.9,side:O}),p=new g(l,f);p.castShadow=!1,p.receiveShadow=!1,p.position.set((Math.random()-.5)*u*2,(Math.random()-.5)*u,(Math.random()-.5)*u*2),r.add(p)}r.position.set((Math.random()-.5)*100,20+Math.random()*10,(Math.random()-.5)*100),this.cloudGroup.add(r),this.clouds.push(r)}}update(e){this.clouds.forEach(t=>{t.position.add(this.windDirection.clone().multiplyScalar(this.windSpeed*e)),t.position.x>50?t.position.x=-50:t.position.x<-50&&(t.position.x=50),t.position.z>50?t.position.z=-50:t.position.z<-50&&(t.position.z=50)})}getCloudGroup(){return this.cloudGroup}}class Ie{constructor(e,t,s,i,a){o(this,"camera");o(this,"scene");o(this,"terrain");o(this,"sceneManager");o(this,"jukebox");o(this,"canvas");o(this,"moveForward",!1);o(this,"moveBackward",!1);o(this,"moveLeft",!1);o(this,"moveRight",!1);o(this,"moveUp",!1);o(this,"moveDown",!1);o(this,"canJump",!0);o(this,"isFlyMode",!1);o(this,"velocity",new S);o(this,"direction",new S);o(this,"verticalVelocity",0);o(this,"movementSpeed",5);o(this,"jumpHeight",10);o(this,"gravity",30);o(this,"flySpeed",5);o(this,"isPointerLocked",!1);o(this,"euler",new se(0,0,0,"YXZ"));o(this,"mouseSensitivity",.002);o(this,"playerHeight",1.7);o(this,"onPointerLockChange",()=>{this.isPointerLocked=document.pointerLockElement===this.canvas});o(this,"onPointerLockError",()=>{console.error("Pointer lock error")});o(this,"onCanvasClick",()=>{this.isPointerLocked||this.canvas.requestPointerLock()});o(this,"onMouseMove",e=>{this.isPointerLocked&&(this.euler.setFromQuaternion(this.camera.quaternion),this.euler.y-=e.movementX*this.mouseSensitivity,this.euler.x-=e.movementY*this.mouseSensitivity,this.euler.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.euler.x)),this.camera.quaternion.setFromEuler(this.euler))});o(this,"onKeyDown",e=>{switch(e.code){case"KeyW":this.moveForward=!0;break;case"KeyS":this.moveBackward=!0;break;case"KeyA":this.moveLeft=!0;break;case"KeyD":this.moveRight=!0;break;case"KeyQ":this.isFlyMode&&(this.moveDown=!0);break;case"KeyE":this.isFlyMode&&(this.moveUp=!0);break;case"Space":this.canJump&&!this.isFlyMode&&(this.verticalVelocity=this.jumpHeight,this.camera.position.y+=.1,this.canJump=!1);break;case"KeyF":this.isFlyMode=!this.isFlyMode,this.isFlyMode?(this.verticalVelocity=0,this.canJump=!1):(this.moveUp=!1,this.moveDown=!1);break;case"KeyT":this.sceneManager.toggleWireframeMode();break;case"KeyN":this.jukebox.nextSong();break}});o(this,"onKeyUp",e=>{switch(e.code){case"KeyW":this.moveForward=!1;break;case"KeyS":this.moveBackward=!1;break;case"KeyA":this.moveLeft=!1;break;case"KeyD":this.moveRight=!1;break;case"KeyQ":this.moveDown=!1;break;case"KeyE":this.moveUp=!1;break}});this.camera=e,this.scene=t,this.terrain=s,this.sceneManager=i,this.jukebox=a,this.canvas=document.getElementById("scene-canvas");const r=(Math.random()-.5)*100,c=(Math.random()-.5)*100,d=this.terrain.getHeightAt(r,c)+this.playerHeight;this.camera.position.set(r,d,c);const u=new S(r,0,c).normalize(),l=Math.atan2(u.x,u.z);this.euler.set(0,l,0),this.camera.quaternion.setFromEuler(this.euler),this.initPointerLock(),this.initKeyboardControls()}initPointerLock(){document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1),this.canvas.addEventListener("click",this.onCanvasClick),document.addEventListener("mousemove",this.onMouseMove)}initKeyboardControls(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}update(e){if(!this.isPointerLocked)return;if(this.isFlyMode){const r=(Number(this.moveUp)-Number(this.moveDown))*this.flySpeed*e;this.camera.position.y+=r}else{const r=this.terrain.getHeightAt(this.camera.position.x,this.camera.position.z);this.camera.position.y>r+this.playerHeight?(this.verticalVelocity-=this.gravity*e,this.camera.position.y+=this.verticalVelocity*e,this.canJump=!1):(this.camera.position.y=r+this.playerHeight,this.verticalVelocity=0,this.canJump=!0)}this.direction.z=Number(this.moveForward)-Number(this.moveBackward),this.direction.x=Number(this.moveLeft)-Number(this.moveRight),this.direction.normalize(),this.velocity.z=this.direction.z*this.movementSpeed*e,this.velocity.x=this.direction.x*this.movementSpeed*e;const t=new S;this.camera.getWorldDirection(t),t.y=0,t.normalize();const s=new S().crossVectors(new S(0,1,0),t).normalize(),i=this.velocity.x*s.x+this.velocity.z*t.x,a=this.velocity.x*s.z+this.velocity.z*t.z;this.camera.position.x+=i,this.camera.position.z+=a}dispose(){document.removeEventListener("pointerlockchange",this.onPointerLockChange),document.removeEventListener("pointerlockerror",this.onPointerLockError),this.canvas.removeEventListener("click",this.onCanvasClick),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.pointerLockElement===this.canvas&&document.exitPointerLock()}savePosition(){}loadPosition(){}resetPosition(){const e=(Math.random()-.5)*100,t=(Math.random()-.5)*100,s=this.terrain.getHeightAt(e,t)+this.playerHeight;this.camera.position.set(e,s,t),this.camera.rotation.set(0,0,0),this.euler.set(0,0,0),this.camera.quaternion.setFromEuler(this.euler),this.verticalVelocity=0}getPosition(){return this.camera.position.clone()}getRotationY(){return this.euler.y}}class Y extends Event{constructor(e){super("songchange"),this.songTitle=e}}class He{constructor(e,t){o(this,"scene");o(this,"terrain");o(this,"jukeboxGroup");o(this,"audioListener");o(this,"audio");o(this,"isPlaying",!1);o(this,"isMuted",!1);o(this,"lastVolume",.3);o(this,"currentSong",Math.floor(Math.random()*2));o(this,"songs",["ost/Vibe Beach.mp3","ost/Goth Vibe Beach.mp3"]);o(this,"songTitles",["Sunset Serenade - Jack Sanderson & The Beachcombers","Midnight Tide - Luna Blackwood"]);o(this,"initAudioHandler",null);this.scene=e,this.terrain=t,this.jukeboxGroup=new F,this.audioListener=new de,this.audio=new ue(this.audioListener),this.createJukeboxModel(),this.setupAudio(),this.scene.add(this.jukeboxGroup),this.initAudioHandler=()=>{this.isPlaying||(this.audio.play(),this.isPlaying=!0),this.removeInitListeners()},this.addInitListeners()}addInitListeners(){this.initAudioHandler&&(document.addEventListener("click",this.initAudioHandler),document.addEventListener("keydown",this.initAudioHandler))}removeInitListeners(){this.initAudioHandler&&(document.removeEventListener("click",this.initAudioHandler),document.removeEventListener("keydown",this.initAudioHandler),this.initAudioHandler=null)}dispose(){this.audio.isPlaying&&this.audio.stop(),this.isPlaying=!1,this.removeInitListeners(),this.scene.remove(this.jukeboxGroup),this.audio.buffer&&(this.audio.buffer=null),this.audio.disconnect()}createJukeboxModel(){const e=new G(1.2,.1,.8),t=new x({color:9127187,roughness:.8,metalness:.2}),s=new g(e,t);s.position.y=.05,this.jukeboxGroup.add(s);const i=new G(1,1.2,.6),a=new x({color:2003199,roughness:.7,metalness:.3}),r=new g(i,a);r.position.y=.7,this.jukeboxGroup.add(r);const c=new me(.15,32),d=new x({color:0,roughness:.9,metalness:.1}),u=new g(c,d);u.position.set(-.3,.7,.31),u.rotation.y=Math.PI,this.jukeboxGroup.add(u);const l=new g(c,d);l.position.set(.3,.7,.31),l.rotation.y=Math.PI,this.jukeboxGroup.add(l);const f=new G(.8,.2,.1),p=new x({color:3355443,roughness:.5,metalness:.5}),m=new g(f,p);m.position.set(0,1.3,.31),this.jukeboxGroup.add(m);const y=new I(.03,.03,.02,16),w=new x({color:16711680,roughness:.3,metalness:.7}),D=new g(y,w);D.position.set(-.2,1.3,.36),D.rotation.x=Math.PI/2,this.jukeboxGroup.add(D);const M=new g(y,w);M.position.set(.2,1.3,.36),M.rotation.x=Math.PI/2,this.jukeboxGroup.add(M),this.jukeboxGroup.traverse(k=>{k instanceof g&&(k.castShadow=!0,k.receiveShadow=!0)})}setupAudio(){const e=new q,t=this.songs[this.currentSong];e.load(t,s=>{this.audio.setBuffer(s),this.audio.setVolume(.3),this.audio.setLoop(!0);const i=this.getCurrentSongTitle();document.dispatchEvent(new Y(i))},s=>{console.log(`${s.loaded/s.total*100}% loaded`)},s=>{console.error("Error loading audio:",s)})}getCurrentSongTitle(){return this.songTitles[this.currentSong]}setPosition(e){this.jukeboxGroup.position.copy(e)}togglePlay(){this.isMuted=!this.isMuted,this.isMuted?(this.lastVolume=this.audio.getVolume(),this.audio.setVolume(0)):this.audio.setVolume(this.lastVolume)}setVolume(e){this.audio.setVolume(e),e>0&&(this.lastVolume=e),this.isMuted=e===0}nextSong(){this.currentSong=(this.currentSong+1)%this.songs.length,this.audio.stop(),new q().load(this.songs[this.currentSong],t=>{if(this.audio.setBuffer(t),this.isPlaying){this.audio.play();const s=this.getCurrentSongTitle();document.dispatchEvent(new Y(s))}})}getPosition(){return this.jukeboxGroup.position.clone()}isNearby(e,t=3){return this.jukeboxGroup.position.distanceTo(e)<t}setAudioListener(e){e.add(this.audioListener)}getMutedState(){return this.isMuted}}class Ge{constructor(e){o(this,"mesh");o(this,"scene");this.scene=e,this.mesh=new F,this.createLighthouse()}createLighthouse(){const e=new I(1.5,2.25,15,8),t=new x({color:16777215,roughness:.7,metalness:.3}),s=new g(e,t);s.position.y=7.5,s.castShadow=!0,s.receiveShadow=!0,this.mesh.add(s);const i=new x({color:13369344,roughness:.7,metalness:.3});for(let k=0;k<3;k++){const j=new I(1.6,2.35,.75,8),T=new g(j,i);T.position.y=3.75+k*3.75,this.mesh.add(T)}const a=new I(3,3,2.25,8),r=new x({color:16777215,roughness:.7,metalness:.3}),c=new g(a,r);c.position.y=15,c.castShadow=!0,c.receiveShadow=!0,this.mesh.add(c);const d=new R(1.5,1.125),u=new x({color:8900331,roughness:.2,metalness:.8}),l=8,f=2.8;for(let k=0;k<l;k++){const j=new g(d,u),T=k/l*Math.PI*2+Math.PI/8;j.position.set(Math.cos(T)*f,15,Math.sin(T)*f),j.lookAt(0,15,0),j.rotateY(Math.PI),this.mesh.add(j)}const p=new te(3.75,3.25,8),m=new x({color:3355443,roughness:.8,metalness:.2}),y=new g(p,m);y.position.y=17.125,y.castShadow=!0,this.mesh.add(y);const w=new I(3.75,4.5,1.5,8),D=new x({color:8947848,roughness:.8,metalness:.2}),M=new g(w,D);M.position.y=.75,M.castShadow=!0,M.receiveShadow=!0,this.mesh.add(M),this.scene.add(this.mesh)}getMesh(){return this.mesh}setPosition(e,t,s){this.mesh.position.set(e,t,s)}dispose(){this.scene.remove(this.mesh),this.mesh.traverse(e=>{e instanceof g&&(e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())})}}function Re(){const h=new fe(4210943,.8),e=new X(16777215,4.5);e.position.set(10,20,10),e.castShadow=!0,e.shadow.mapSize.width=4096,e.shadow.mapSize.height=4096,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-100,e.shadow.camera.right=100,e.shadow.camera.top=100,e.shadow.camera.bottom=-100,e.shadow.bias=-1e-4,e.shadow.normalBias=.01,e.shadow.radius=2,e.target.position.set(0,0,0),e.target.updateMatrixWorld();const t=new X(16777215,1.5);return t.position.copy(e.position),t.castShadow=!0,{ambientLight:h,directionalLight:e,shadowLight:t}}class Ve{constructor(){o(this,"ocean");o(this,"time",0);o(this,"uniforms");const e=new R(1e3,1e3,128,128);e.rotateX(-Math.PI/2),this.uniforms={time:{value:0},waveHeight:{value:.2},waveSpeed:{value:.8},waveLength:{value:8},noiseScale:{value:.05},noiseStrength:{value:.3},waterColor:{value:new A(8900331)},waterOpacity:{value:.2},maxDepth:{value:20}};const t=new C({uniforms:this.uniforms,vertexShader:`
        uniform float time;
        uniform float waveHeight;
        uniform float waveSpeed;
        uniform float waveLength;
        uniform float noiseScale;
        uniform float noiseStrength;
        
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying float vWaveHeight;
        varying float vDepth;
        varying vec2 vNoisePos;
        
        // Improved noise function
        float random(vec2 st) {
          return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
        }
        
        float noise(vec2 st) {
          vec2 i = floor(st);
          vec2 f = fract(st);
          
          float a = random(i);
          float b = random(i + vec2(1.0, 0.0));
          float c = random(i + vec2(0.0, 1.0));
          float d = random(i + vec2(1.0, 1.0));
          
          vec2 u = f * f * (3.0 - 2.0 * f);
          return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
        }
        
        float fbm(vec2 st) {
          float value = 0.0;
          float amplitude = 0.5;
          float frequency = 1.0;
          
          for (int i = 0; i < 4; i++) {
            value += amplitude * noise(st * frequency);
            st *= 2.0;
            amplitude *= 0.5;
            frequency *= 2.0;
          }
          return value;
        }
        
        void main() {
          vec3 pos = position;
          
          // Base wave pattern
          float wave1 = sin(pos.x / waveLength + time * waveSpeed) * 
                      cos(pos.z / waveLength + time * waveSpeed);
          
          float wave2 = sin(pos.x / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                      cos(pos.z / (waveLength * 0.5) + time * waveSpeed * 1.2);
          
          // Add noise-based waves
          vec2 noisePos = pos.xz * noiseScale;
          float noiseWave = fbm(noisePos + time * waveSpeed * 0.5);
          
          // Combine waves with noise
          float wave = (wave1 + wave2 * 0.5 + noiseWave * noiseStrength) * waveHeight;
          
          pos.y += wave;
          
          // Calculate normal with improved accuracy
          float dx1 = cos(pos.x / waveLength + time * waveSpeed) * 
                    cos(pos.z / waveLength + time * waveSpeed) * 
                    waveHeight / waveLength;
          float dz1 = sin(pos.x / waveLength + time * waveSpeed) * 
                    -sin(pos.z / waveLength + time * waveSpeed) * 
                    waveHeight / waveLength;
                    
          float dx2 = cos(pos.x / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    cos(pos.z / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    waveHeight / (waveLength * 0.5);
          float dz2 = sin(pos.x / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    -sin(pos.z / (waveLength * 0.5) + time * waveSpeed * 1.2) * 
                    waveHeight / (waveLength * 0.5);
          
          // Add noise-based normal variation
          vec2 noisePos2 = pos.xz * noiseScale * 2.0;
          float noiseDx = fbm(noisePos2 + vec2(0.1, 0.0) + time * waveSpeed * 0.5);
          float noiseDz = fbm(noisePos2 + vec2(0.0, 0.1) + time * waveSpeed * 0.5);
          
          vec3 normal = normalize(vec3(
            -(dx1 + dx2 * 0.5 + noiseDx * noiseStrength),
            1.0,
            -(dz1 + dz2 * 0.5 + noiseDz * noiseStrength)
          ));
          
          vDepth = -pos.y;
          vNormal = normal;
          vPosition = pos;
          vWaveHeight = wave;
          vNoisePos = pos.xz * 0.1 + time * 0.2; // For foam noise
          
          gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
        }
      `,fragmentShader:`
        uniform float time;
        uniform vec3 waterColor;
        uniform float waterOpacity;
        uniform float maxDepth;
        
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying float vWaveHeight;
        varying float vDepth;
        varying vec2 vNoisePos;
        
        // Improved noise function
        float random(vec2 st) {
          return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
        }
        
        float noise(vec2 st) {
          vec2 i = floor(st);
          vec2 f = fract(st);
          
          float a = random(i);
          float b = random(i + vec2(1.0, 0.0));
          float c = random(i + vec2(0.0, 1.0));
          float d = random(i + vec2(1.0, 1.0));
          
          vec2 u = f * f * (3.0 - 2.0 * f);
          return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
        }
        
        float fbm(vec2 st) {
          float value = 0.0;
          float amplitude = 0.5;
          float frequency = 1.0;
          
          for (int i = 0; i < 4; i++) {
            value += amplitude * noise(st * frequency);
            st *= 2.0;
            amplitude *= 0.5;
            frequency *= 2.0;
          }
          return value;
        }
        
        void main() {
          // Calculate water color with depth
          float depthFactor = smoothstep(0.0, maxDepth, vDepth);
          vec3 color = mix(waterColor, waterColor * 0.7, depthFactor);
          
          // Calculate foam using multiple noise layers
          float foamNoise1 = fbm(vNoisePos);
          float foamNoise2 = fbm(vNoisePos * 2.0 + 10.0);
          float foamNoise3 = fbm(vNoisePos * 4.0 + 20.0);
          
          // Combine noise layers for more interesting foam pattern
          float foamPattern = (foamNoise1 * 0.5 + foamNoise2 * 0.3 + foamNoise3 * 0.2);
          
          // Wave peak foam
          float waveFoam = smoothstep(0.0, 0.2, vWaveHeight) * 
                          (1.0 - smoothstep(0.2, 0.4, vWaveHeight));
          
          // Shore foam
          float shoreDistance = length(vPosition.xz);
          float shoreFoam = smoothstep(45.0, 50.0, shoreDistance) * 
                          (1.0 - smoothstep(50.0, 55.0, shoreDistance));
          
          // Combine foam effects with noise
          float foamAmount = max(waveFoam, shoreFoam) * foamPattern;
          
          // Add foam to color
          color = mix(color, vec3(1.0), foamAmount);
          
          // Add specular highlights
          vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));
          float spec = pow(max(dot(reflect(-lightDir, vNormal), normalize(vPosition)), 0.0), 32.0);
          color += spec * 0.3;
          
          gl_FragColor = vec4(color, waterOpacity);
        }
      `,transparent:!0,depthWrite:!1,side:O});this.ocean=new g(e,t),this.ocean.position.y=0}update(e){this.time+=e,this.uniforms.time.value=this.time}getMesh(){return this.ocean}dispose(){this.ocean.geometry.dispose(),this.ocean.material instanceof C&&this.ocean.material.dispose()}}class Ke{constructor(e,t){o(this,"mesh");o(this,"lifetime");o(this,"currentTime");const s=new R(t,t),i=new x({color:12101784,transparent:!0,opacity:.2,roughness:.9});this.mesh=new g(s,i),this.mesh.rotation.x=-Math.PI/2,this.mesh.position.copy(e),this.mesh.position.y+=.01,this.lifetime=5,this.currentTime=0}update(e){this.currentTime+=e;const t=this.currentTime/this.lifetime;return this.mesh.material instanceof x&&(this.mesh.material.opacity=.8*(1-t)),t>=1}getMesh(){return this.mesh}}class We{constructor(e,t){o(this,"trails",[]);o(this,"scene");o(this,"terrain");o(this,"lastTrailPosition",null);o(this,"minDistance",.5);this.scene=e,this.terrain=t}update(e,t){const s=this.terrain.getHeightAt(t.x,t.z),i=new S(t.x,s,t.z);(!this.lastTrailPosition||this.lastTrailPosition.distanceTo(i)>=this.minDistance)&&(this.createTrail(i),this.lastTrailPosition=i.clone()),this.trails=this.trails.filter(a=>{const r=a.update(e);return r&&this.scene.remove(a.getMesh()),!r})}createTrail(e){const t=new Ke(e,.3);this.scene.add(t.getMesh()),this.trails.push(t)}dispose(){for(const e of this.trails)this.scene.remove(e.getMesh());this.trails=[]}}function Ue(){const e=new ie().load("/vibe-beach/textures/autumn.jpeg");return e.mapping=pe,e}const H=class H{constructor(e,t,s,i){o(this,"mesh");o(this,"uniforms");o(this,"position");o(this,"size");o(this,"currentLOD");o(this,"geometries");o(this,"lastUpdateTime",0);o(this,"updateInterval",0);o(this,"baseHeight");this.position=e,this.size=t,this.currentLOD=0,this.baseHeight=i,this.geometries=H.LOD_LEVELS.map(r=>{const c=new R(t,t,r.resolution,r.resolution);c.rotateX(-Math.PI/2);const u=c.attributes.position.array,l=u.length/3;for(let f=0;f<l;f++){const p=u[f*3],m=u[f*3+2],y=p+e.x,w=m+e.y,D=Math.sqrt(y*y+w*w),M=40,k=.005,j=12,T=.4,W=new b(y,w).multiplyScalar(k);let E=this.fbm(W)*j*T;E+=Math.sin(y*.03)*Math.cos(w*.03)*.05;const P=45,L=-1.5,N=4,K=this.smoothstep(M,P,D),z=1-this.smoothstep(0,M*.7,D);E+=z*N,E=this.mix(E,L,K),u[f*3+1]=E+i}return c.computeVertexNormals(),c}),this.uniforms={time:{value:0},sandColor:{value:new A(16044095)},sandColor2:{value:new A(15844367)},sandColor3:{value:new A(15965202)},sandColor4:{value:new A(15105570)},sandTexture:{value:s},lightDirection:{value:new S(1,1,1)},fogColor:{value:new A(8900331)},fogDensity:{value:.01}};const a=new C({uniforms:this.uniforms,vertexShader:`
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;
        varying float vFogDepth;
        
        void main() {
          vNormal = normal;
          vPosition = position;
          vUv = uv * 10.1;
          
          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
          vFogDepth = -mvPosition.z;
          
          gl_Position = projectionMatrix * mvPosition;
        }
      `,fragmentShader:`
        uniform sampler2D sandTexture;
        uniform vec3 lightDirection;
        uniform vec3 fogColor;
        uniform float fogDensity;
        
        varying vec3 vNormal;
        varying vec3 vPosition;
        varying vec2 vUv;
        varying float vFogDepth;
        
        void main() {
          vec4 sandColor = texture2D(sandTexture, vUv);
          
          // Enhanced lighting
          float diffuse = max(0.0, dot(vNormal, normalize(lightDirection)));
          vec3 color = sandColor.rgb * (diffuse * 0.8 + 0.5);
          
          // Add some specular highlights
          vec3 viewDir = normalize(-vPosition);
          vec3 reflectDir = reflect(-normalize(lightDirection), vNormal);
          float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.0);
          color += spec * 0.15;
          
          // Apply fog
          float fogFactor = 1.0 - exp(-fogDensity * fogDensity * vFogDepth * vFogDepth);
          color = mix(color, fogColor, fogFactor);
          
          gl_FragColor = vec4(color, 1.0);
        }
      `});this.mesh=new g(this.geometries[0],a),this.mesh.position.set(e.x,0,e.y),this.mesh.receiveShadow=!0,this.mesh.castShadow=!1,this.mesh.customDepthMaterial=void 0}updateLOD(e){const t=new b(e.x-this.position.x,e.z-this.position.y).length();let s=0;for(let i=0;i<H.LOD_LEVELS.length&&t>=H.LOD_LEVELS[i].distance;i++)s=i;s!==this.currentLOD&&(this.mesh.geometry=this.geometries[s],this.currentLOD=s),this.updateInterval=Math.max(.1,t*.01)}shouldUpdate(e){return e-this.lastUpdateTime>=this.updateInterval}update(e,t){this.shouldUpdate(t)&&(this.uniforms.time.value+=e,this.lastUpdateTime=t)}getMesh(){return this.mesh}getPosition(){return this.position}getSize(){return this.size}updateUniforms(e,t,s){this.uniforms.lightDirection.value=e,this.uniforms.fogColor.value=t,this.uniforms.fogDensity.value=s}dispose(){for(const e of this.geometries)e.dispose();this.mesh.material instanceof C&&this.mesh.material.dispose()}fbm(e){let t=0,s=.5,i=1;for(let a=0;a<4;a++)t+=s*this.noise(e.clone().multiplyScalar(i)),e.multiplyScalar(2),s*=.5,i*=2;return t}noise(e){const t=new b(Math.floor(e.x),Math.floor(e.y)),s=new b(e.x-t.x,e.y-t.y),i=this.random(t),a=this.random(new b(t.x+1,t.y)),r=this.random(new b(t.x,t.y+1)),c=this.random(new b(t.x+1,t.y+1)),d=new b(s.x*s.x*(3-2*s.x),s.y*s.y*(3-2*s.y));return this.mix(this.mix(i,a,d.x),this.mix(r,c,d.x),d.y)}random(e){return Math.sin(e.dot(new b(12.9898,78.233)))*43758.5453123%1}mix(e,t,s){return e*(1-s)+t*s}smoothstep(e,t,s){const i=Math.max(0,Math.min(1,(s-e)/(t-e)));return i*i*(3-2*i)}};o(H,"LOD_LEVELS",[{resolution:64,distance:0},{resolution:32,distance:24}]);let B=H;class Be{constructor(e,t,s=0){o(this,"chunks");o(this,"scene");o(this,"camera");o(this,"sandTexture");o(this,"chunkSize");o(this,"viewDistance");o(this,"loadedChunks");o(this,"frustum");o(this,"projScreenMatrix");o(this,"updateQueue",[]);o(this,"MAX_UPDATES_PER_FRAME",4);o(this,"lastChunkUpdateTime",0);o(this,"CHUNK_UPDATE_INTERVAL",.1);o(this,"baseHeight");o(this,"isWireframeMode",!1);this.chunks=new Map,this.scene=e,this.camera=t,this.chunkSize=32,this.viewDistance=96,this.loadedChunks=new Set,this.frustum=new ge,this.projScreenMatrix=new we,this.baseHeight=s;const i=new ie;this.sandTexture=i.load("/vibe-beach/textures/sand.jpg"),this.sandTexture.wrapS=Q,this.sandTexture.wrapT=Q,this.sandTexture.repeat.set(20,20),this.sandTexture.minFilter=$,this.sandTexture.magFilter=$,this.sandTexture.generateMipmaps=!1,this.updateChunks()}update(e){const t=performance.now()/1e3;t-this.lastChunkUpdateTime>=this.CHUNK_UPDATE_INTERVAL&&(this.projScreenMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.frustum.setFromProjectionMatrix(this.projScreenMatrix),this.updateChunks(),this.lastChunkUpdateTime=t),this.updateQueue=Array.from(this.chunks.values()).filter(i=>this.isChunkVisible(i)).sort((i,a)=>{const r=new b(this.camera.position.x-i.getPosition().x,this.camera.position.z-i.getPosition().y).length(),c=new b(this.camera.position.x-a.getPosition().x,this.camera.position.z-a.getPosition().y).length();return r-c});for(const i of this.updateQueue)i.updateLOD(this.camera.position);const s=Math.min(this.MAX_UPDATES_PER_FRAME,this.updateQueue.length);for(let i=0;i<s;i++)this.updateQueue[i].update(e,t)}updateChunks(){const e=new b(this.camera.position.x,this.camera.position.z),t=Math.floor((e.x-this.viewDistance)/this.chunkSize),s=Math.ceil((e.x+this.viewDistance)/this.chunkSize),i=Math.floor((e.y-this.viewDistance)/this.chunkSize),a=Math.ceil((e.y+this.viewDistance)/this.chunkSize);for(let r=t;r<=s;r++)for(let c=i;c<=a;c++){const d=`${r},${c}`,u=new b(r*this.chunkSize,c*this.chunkSize);if(!this.chunks.has(d)){const l=new B(u,this.chunkSize,this.sandTexture,this.baseHeight);this.chunks.set(d,l),this.scene.add(l.getMesh())}}for(const[r,c]of this.chunks.entries())e.distanceTo(c.getPosition())>this.viewDistance*1.5&&(this.scene.remove(c.getMesh()),c.dispose(),this.chunks.delete(r))}isChunkVisible(e){const t=new ve,s=e.getSize(),i=e.getPosition();return t.setFromCenterAndSize(new S(i.x,0,i.y),new S(s,20,s)),this.frustum.intersectsBox(t)}getHeightAt(e,t){const s=Math.floor(e/this.chunkSize),i=Math.floor(t/this.chunkSize),a=`${s},${i}`;if(!this.chunks.get(a))return this.baseHeight;const c=.005,d=12,u=.4,l=Math.sqrt(e*e+t*t),f=40,p=new b(e,t).multiplyScalar(c);let m=this.fbm(p)*d*u;m+=Math.sin(e*.03)*Math.cos(t*.03)*.05;const y=45,w=-1.5,D=4,M=this.smoothstep(f,y,l),k=1-this.smoothstep(0,f*.7,l);return m+=k*D,m=this.mix(m,w,M),m+this.baseHeight}getNormalAt(e,t){const i=this.getHeightAt(e-.1,t),a=this.getHeightAt(e+.1,t),r=this.getHeightAt(e,t-.1),c=this.getHeightAt(e,t+.1);return new S(i-a,2*.1,r-c).normalize()}fbm(e){let t=0,s=.5,i=1;for(let a=0;a<4;a++)t+=s*this.noise(e.clone().multiplyScalar(i)),e.multiplyScalar(2),s*=.5,i*=2;return t}noise(e){const t=new b(Math.floor(e.x),Math.floor(e.y)),s=new b(e.x-t.x,e.y-t.y),i=this.random(t),a=this.random(new b(t.x+1,t.y)),r=this.random(new b(t.x,t.y+1)),c=this.random(new b(t.x+1,t.y+1)),d=new b(s.x*s.x*(3-2*s.x),s.y*s.y*(3-2*s.y));return this.mix(this.mix(i,a,d.x),this.mix(r,c,d.x),d.y)}random(e){return Math.sin(e.dot(new b(12.9898,78.233)))*43758.5453123%1}mix(e,t,s){return e*(1-s)+t*s}smoothstep(e,t,s){const i=Math.max(0,Math.min(1,(s-e)/(t-e)));return i*i*(3-2*i)}updateUniforms(e,t,s){for(const i of this.chunks.values())i.updateUniforms(e,t,s)}dispose(){for(const e of this.chunks.values())this.scene.remove(e.getMesh()),e.dispose();this.chunks.clear(),this.sandTexture.dispose()}setWireframeMode(e){this.isWireframeMode=e;for(const t of this.chunks.values()){const s=t.getMesh().material;if(s instanceof x||s instanceof C)s.wireframe=e;else if(Array.isArray(s))for(const i of s)(i instanceof x||i instanceof C)&&(i.wireframe=e)}}getChunkSize(){return this.chunkSize}getViewDistance(){return this.viewDistance}}class Oe{constructor(){o(this,"scene");o(this,"camera");o(this,"renderer");o(this,"clock");o(this,"terrain");o(this,"controller");o(this,"sandTrailManager");o(this,"ocean");o(this,"lighthouse");o(this,"clouds");o(this,"ambientLight");o(this,"directionalLight");o(this,"shadowLight");o(this,"timeOfDay",12);o(this,"isWireframeMode",!1);o(this,"animationFrameId",null);o(this,"TERRAIN_BASE_HEIGHT",1);o(this,"beachFurniture");o(this,"jukebox");o(this,"otherPlayers",new Map);o(this,"playerNameToTexture",{});o(this,"animate",()=>{this.animationFrameId=requestAnimationFrame(this.animate);const e=this.clock.getDelta();if(this.controller.update(e),this.sandTrailManager&&this.controller){const t=this.controller.getPosition();t&&this.sandTrailManager.update(e,t)}if(this.ocean.update(e),this.clouds.update(e),this.terrain.update(e),this.otherPlayers&&this.otherPlayers.size>0){for(const[t,s]of this.otherPlayers)if(s.userData.targetPosition&&s.userData.targetQuaternion){s.position.lerp(s.userData.targetPosition,.1),s.quaternion.slerp(s.userData.targetQuaternion,.1);const i=s.getObjectByName("nicknameSprite");i&&i.position.copy(s.position).add(new S(0,1,0))}}this.renderer.render(this.scene,this.camera)});this.scene=new xe,this.scene.background=Ue(),this.scene.environment=this.scene.background,this.scene.fog=new V(8900331,.01),this.camera=new ye(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,1.7,0);const e=document.getElementById("scene-canvas");this.renderer=new be({canvas:e,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=ke,this.renderer.shadowMap.autoUpdate=!0,this.clock=new Me,this.initScene(),this.controller=new Ie(this.camera,this.scene,this.terrain,this,this.jukebox),this.controller.loadPosition(),this.sandTrailManager=new We(this.scene,this.terrain),this.ocean=new Ve,this.scene.add(this.ocean.getMesh()),this.animate(),this.setupPositionSaving()}getPlayerTransform(){if(!this.controller)return null;const e=this.controller.getPosition(),t=this.controller.getRotationY();return!e||typeof t!="number"?null:{x:e.x,y:e.y,z:e.z,rotationY:t}}updateRemotePlayerVisuals(e,t){const s=new Set(Object.keys(e));for(const i in e){const a=e[i];if(!a)continue;let r=this.otherPlayers.get(i),c=this.playerNameToTexture[i];if(r){const d=t[i]||i.substring(0,6),u=r.getObjectByName("nicknameSprite");if(u&&c&&u.userData.currentNickname!==d){const l=c.image.getContext("2d");l&&(l.clearRect(0,0,c.image.width,c.image.height),l.font="bold 24px Arial",l.fillStyle="rgba(255, 255, 255, 0.9)",l.textAlign="center",l.textBaseline="middle",l.fillText(d,c.image.width/2,c.image.height/2),c.needsUpdate=!0,u.userData.currentNickname=d)}}else{const d=new Se(.4,.8,4,8),u=i.split("").reduce((D,M)=>D+M.charCodeAt(0),0),l=new A(Math.sin(u*.123+.5)*.4+.3,Math.sin(u*.234+1)*.4+.3,Math.sin(u*.345+1.5)*.4+.3),f=new x({color:l,roughness:.7,metalness:.1});r=new g(d,f),r.castShadow=!0,r.receiveShadow=!0;const p=document.createElement("canvas");p.width=256,p.height=64;const m=p.getContext("2d");m&&(m.font="bold 24px Arial",m.fillStyle="rgba(255, 255, 255, 0.9)",m.textAlign="center",m.textBaseline="middle",m.fillText(t[i]||i.substring(0,6),p.width/2,p.height/2)),c=new Pe(p),c.needsUpdate=!0,this.playerNameToTexture[i]=c;const y=new Le({map:c,transparent:!0,alphaTest:.1}),w=new J(y);w.position.set(0,1,0),w.scale.set(1.5,.375,1),w.name="nicknameSprite",r.add(w),this.scene.add(r),this.otherPlayers.set(i,r)}r.userData.targetPosition=new S(a.x,a.y,a.z),r.userData.targetQuaternion=new De().setFromEuler(new se(0,a.rotationY,0,"YXZ"))}for(const[i,a]of this.otherPlayers)if(!s.has(i)){if(this.scene.remove(a),a.geometry&&a.geometry.dispose(),a.material instanceof Ne)a.material.dispose();else if(Array.isArray(a.material))for(const d of a.material)d.dispose();const r=a.children.find(d=>d instanceof J);if(r){const d=r.material;d.map&&d.map.dispose(),d.dispose()}this.otherPlayers.delete(i);const c=this.playerNameToTexture[i];c&&(c.dispose(),delete this.playerNameToTexture[i])}}initScene(){const{ambientLight:e,directionalLight:t,shadowLight:s}=Re();this.ambientLight=e,this.directionalLight=t,this.shadowLight=s,this.scene.add(this.ambientLight,this.directionalLight,this.shadowLight),this.terrain=new Be(this.scene,this.camera,this.TERRAIN_BASE_HEIGHT),this.lighthouse=new Ge(this.scene),this.clouds=new ze,this.scene.add(this.clouds.getCloudGroup()),this.beachFurniture=new Fe(this.scene,this.terrain),this.jukebox=new He(this.scene,this.terrain),this.jukebox.setAudioListener(this.camera),this.scene.fog&&this.terrain.updateUniforms(this.directionalLight.position,this.scene.fog.color,this.scene.fog instanceof V?this.scene.fog.density:.01)}toggleWireframeMode(){this.isWireframeMode=!this.isWireframeMode,this.scene.traverse(e=>{if(e instanceof g)if(Array.isArray(e.material))for(const t of e.material)(t instanceof x||t instanceof Z||t instanceof C)&&(t.wireframe=this.isWireframeMode);else(e.material instanceof x||e.material instanceof Z||e.material instanceof C)&&(e.material.wireframe=this.isWireframeMode)}),this.terrain&&typeof this.terrain.setWireframeMode=="function"&&this.terrain.setWireframeMode(this.isWireframeMode)}setTimeOfDay(e){this.timeOfDay=Math.max(0,Math.min(24,e));const t=(this.timeOfDay-6)/12*Math.PI*2;this.directionalLight.position.set(Math.cos(t)*100,Math.sin(t)*100,50),this.shadowLight.position.copy(this.directionalLight.position),this.timeOfDay<5||this.timeOfDay>19?(this.ambientLight.intensity=.1,this.directionalLight.intensity=.05,this.scene.fog&&this.scene.fog.color.set(51)):this.timeOfDay<7||this.timeOfDay>17?(this.ambientLight.intensity=.3,this.directionalLight.intensity=.5,this.directionalLight.color.set(16755285),this.scene.fog&&this.scene.fog.color.set(16768426)):(this.ambientLight.intensity=.5,this.directionalLight.intensity=1,this.directionalLight.color.set(16777215),this.scene.fog&&this.scene.fog.color.set(8900331)),this.terrain&&this.scene.fog&&this.terrain.updateUniforms(this.directionalLight.position,this.scene.fog.color,this.scene.fog instanceof V?this.scene.fog.density:.01)}setFogDensity(e){this.scene.fog instanceof V&&(this.scene.fog.density=e),this.terrain&&this.scene.fog&&this.terrain.updateUniforms(this.directionalLight.position,this.scene.fog.color,this.scene.fog instanceof V?this.scene.fog.density:.01)}getJukebox(){return this.jukebox}getWorldDimensions(){if(this.terrain){const e=this.terrain.getChunkSize(),s=(2*this.terrain.getViewDistance()+1)*e;return{width:s,depth:s,heightScale:50}}return console.warn("SceneManager.getWorldDimensions(): Terrain not available, using default."),{width:500,depth:500,heightScale:50}}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}resetCamera(){this.controller.resetPosition()}dispose(){var e,t,s,i,a,r,c,d,u;this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId),this.scene.traverse(l=>{if(l instanceof g&&(l.geometry&&l.geometry.dispose(),l.material))if(Array.isArray(l.material))for(const f of l.material)f.dispose();else l.material.dispose()}),this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.environment&&this.scene.environment.dispose&&this.scene.environment.dispose(),(e=this.terrain)==null||e.dispose(),(t=this.ocean)==null||t.dispose(),(s=this.lighthouse)==null||s.dispose(),(i=this.beachFurniture)==null||i.dispose(),(a=this.jukebox)==null||a.dispose(),(r=this.sandTrailManager)==null||r.dispose(),(c=this.controller)==null||c.dispose();for(const l of this.otherPlayers.values()){const f=l.getObjectByName("nicknameSprite");(d=f==null?void 0:f.material)!=null&&d.map&&f.material.map.dispose(),(u=f==null?void 0:f.material)==null||u.dispose()}this.otherPlayers.clear();for(const l of Object.values(this.playerNameToTexture))l.dispose();this.playerNameToTexture={},this.renderer.dispose()}setupPositionSaving(){setInterval(()=>{this.controller.savePosition()},5e3)}}const _e=({onChange:h})=>n.jsx("div",{className:"bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsx("label",{className:"text-white text-sm font-medium tracking-wider uppercase",children:"Fog Density"}),n.jsx("input",{type:"range",min:"0",max:"0.1",step:"0.001",defaultValue:"0.01",onChange:e=>h(parseFloat(e.target.value)),className:"w-32 h-2 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-gradient-to-r [&::-webkit-slider-thumb]:from-blue-400 [&::-webkit-slider-thumb]:to-purple-400 [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-white/20 [&::-webkit-slider-thumb]:shadow-lg"})]})}),qe=({onChange:h})=>n.jsx("div",{className:"bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsx("label",{className:"text-white text-sm font-medium tracking-wider uppercase",children:"Music Volume"}),n.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",defaultValue:"0.3",onChange:e=>h(parseFloat(e.target.value)),className:"w-32 h-2 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-gradient-to-r [&::-webkit-slider-thumb]:from-blue-400 [&::-webkit-slider-thumb]:to-purple-400 [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-white/20 [&::-webkit-slider-thumb]:shadow-lg"})]})}),Xe=()=>{const[h,e]=v.useState(0),t=v.useRef(0),s=v.useRef(performance.now()),i=v.useRef();return v.useEffect(()=>{const a=()=>{const r=performance.now();t.current++,r-s.current>=1e3&&(e(Math.round(t.current*1e3/(r-s.current))),t.current=0,s.current=r),i.current=requestAnimationFrame(a)};return i.current=requestAnimationFrame(a),()=>{i.current&&cancelAnimationFrame(i.current)}},[]),n.jsxs("div",{className:"absolute top-4 left-4 text-white bg-black/50 px-3 py-1 rounded text-sm",children:["FPS: ",h]})},Qe=()=>{const h=new Date("2025-06-14T15:31:51.353Z"),t=Math.floor((new Date().getTime()-h.getTime())/(1e3*60*60*24)),s=h.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return n.jsxs("div",{className:"bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10 text-white text-sm font-medium tracking-wider",children:["Build: ",s," (",t," days ago)"]})},$e=({title:h,isVisible:e,isMuted:t})=>{const[s,i]=v.useState(0),[a,r]=v.useState(.9);return v.useEffect(()=>{if(e){i(1),r(1);const c=setTimeout(()=>{i(0),r(.9)},3e3);return()=>clearTimeout(c)}},[e,h]),n.jsxs(n.Fragment,{children:[!t&&n.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 text-white text-lg font-bold bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-2 rounded-xl shadow-2xl border border-white/10",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-xs mb-1 text-blue-300 font-medium tracking-wider uppercase",children:"Now Playing"}),n.jsx("div",{className:"text-xl bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent font-bold",children:h})]})}),n.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-2xl font-bold bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-8 py-4 rounded-xl shadow-2xl border border-white/10 transition-all duration-500",style:{opacity:s,transform:`translate(-50%, -50%) scale(${a})`},children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-sm mb-2 text-blue-300 font-medium tracking-wider uppercase",children:"Now Playing"}),n.jsx("div",{className:"text-3xl mb-3 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent font-bold",children:h}),n.jsxs("div",{className:"text-sm text-gray-300/80 flex items-center justify-center gap-3",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),"Press P to mute/unmute"]}),n.jsx("span",{className:"text-gray-500",children:"•"}),n.jsxs("span",{className:"flex items-center",children:[n.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full mr-2"}),"Press N to skip"]})]})]})})]})},Je={width:500,depth:500},Ze={width:150,height:150},Ye=({allPlayerPositions:h,myId:e,allNicknames:t,worldSize:s=Je,minimapSize:i=Ze})=>{const a=(r,c)=>{const d=r/s.width+.5,u=c/s.depth+.5;return{left:`${Math.max(0,Math.min(1,d))*100}%`,top:`${Math.max(0,Math.min(1,u))*100}%`}};return n.jsx("div",{className:"absolute top-4 left-4 bg-black/70 backdrop-blur-sm border border-white/20 rounded-lg shadow-xl overflow-hidden",style:{width:`${i.width}px`,height:`${i.height}px`},children:Object.entries(h).map(([r,c])=>{if(!c)return null;const{left:d,top:u}=a(c.x,c.z),l=r===e,f=t[r]||r.substring(0,6),p=l?"bg-blue-400":"bg-red-400";return n.jsx("div",{className:`absolute w-3 h-3 ${p} rounded-full transform -translate-x-1/2 -translate-y-1/2 shadow-md`,style:{left:d,top:u},title:`${f} (X: ${c.x.toFixed(0)}, Z: ${c.z.toFixed(0)})`,children:l&&n.jsx("div",{className:"w-full h-full rounded-full border-2 border-white animate-ping-slow opacity-75"})},r)})})},et=({isOpen:h,onClose:e})=>{const t=v.useRef(null),s=v.useRef(null),i=v.useRef(null),a=oe(),[r]=ne(),{messages:c,sendMessage:d}=je("beach-chat"),[u,l]=v.useState(""),f=v.useRef(!1);v.useEffect(()=>{h&&(f.current=!0)},[c,h]),v.useEffect(()=>{f.current&&t.current&&h&&(t.current.scrollIntoView({behavior:"smooth"}),f.current=!1)}),v.useEffect(()=>{h&&t.current&&t.current.scrollIntoView({behavior:"smooth"})},[h]),v.useEffect(()=>{h&&s.current&&setTimeout(()=>{var m;(m=s.current)==null||m.focus()},100)},[h]),v.useEffect(()=>{if(!h)return;const m=w=>{["KeyW","KeyA","KeyS","KeyD","Space","KeyN","KeyP","KeyT","KeyF"].includes(w.code)&&w.stopPropagation(),w.code==="Escape"&&(w.stopPropagation(),w.preventDefault(),e())},y=w=>{i.current&&!i.current.contains(w.target)&&e()};return window.addEventListener("keydown",m,!0),document.addEventListener("mousedown",y),()=>{window.removeEventListener("keydown",m,!0),document.removeEventListener("mousedown",y)}},[h,e]);const p=m=>{if(m.preventDefault(),u.trim()!=="")try{a?(d(u),l(""),f.current=!0):(console.log("Cannot send message outside of a session"),l(""))}catch(y){console.error("Failed to send message:",y)}};return h?n.jsxs("div",{ref:i,className:"fixed bottom-4 right-4 w-80 h-96 bg-black/70 backdrop-blur-sm rounded-xl shadow-2xl border border-white/10 flex flex-col overflow-hidden z-50",children:[n.jsxs("div",{className:"px-4 py-3 bg-black/30 border-b border-white/10 flex justify-between items-center",children:[n.jsx("h3",{className:"text-white font-bold",children:"Beach Chat"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"text-xs text-white/70 mr-2",children:"ESC to close"}),n.jsx("button",{type:"button",onClick:m=>{m.stopPropagation(),e()},className:"text-white/70 hover:text-white",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-labelledby":"close-title",children:[n.jsx("title",{id:"close-title",children:"Close"}),n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})]})})]})]}),n.jsxs("div",{className:"flex-1 p-4 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-transparent",children:[a?c.length===0?n.jsx("div",{className:"text-white/50 text-center mt-4",children:"No messages yet. Start the conversation!"}):c.map(m=>n.jsx("div",{className:`mb-3 ${m.senderId===r?"text-right":"text-left"}`,children:n.jsxs("div",{className:`inline-block px-3 py-2 rounded-lg ${m.senderId===r?"bg-blue-500/70 text-white":"bg-white/10 text-white"}`,children:[m.senderId!==r&&n.jsx("div",{className:"text-xs text-blue-300 mb-1 font-medium",children:m.senderId}),n.jsx("div",{children:m.message}),n.jsx("div",{className:"text-xs opacity-50 mt-1",children:new Date(m.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},m.id)):n.jsx("div",{className:"text-red-300 text-center mt-4 p-3 bg-red-500/20 rounded-lg",children:"You're not connected to a multiplayer session. Chat is unavailable."}),n.jsx("div",{ref:t})]}),n.jsx("form",{onSubmit:p,className:"p-3 border-t border-white/10 bg-black/20",children:n.jsxs("div",{className:"flex",children:[n.jsx("input",{ref:s,type:"text",value:u,onChange:m=>l(m.target.value),placeholder:a?"Type a message...":"Chat unavailable in single player",className:"flex-1 bg-white/10 text-white border border-white/20 rounded-l-lg px-3 py-2 outline-none focus:ring-1 focus:ring-blue-500",disabled:!a,onKeyDown:m=>{["KeyW","KeyA","KeyS","KeyD","Space","KeyN","KeyP","KeyT","KeyF"].includes(m.code)&&m.stopPropagation(),(m.key==="Tab"||m.key==="Escape")&&(m.preventDefault(),m.key==="Escape"&&e())}}),n.jsx("button",{type:"submit",disabled:!a,className:`${a?"bg-blue-500 hover:bg-blue-600":"bg-blue-500/50 cursor-not-allowed"} text-white px-4 rounded-r-lg transition-colors`,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-labelledby":"send-title",children:[n.jsx("title",{id:"send-title",children:"Send"}),n.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})]})})]})})]}):null};function tt(){var E;const h=v.useRef(null),[e,t]=v.useState(!0),[s,i]=v.useState(""),[a,r]=v.useState(!1),[c,d]=v.useState(!1),[u,l]=v.useState(!1),f=Te(),p=oe(),[m,y,w]=ne(),[D,M,k]=Ee("player-positions",null,{throttleDelay:50});v.useEffect(()=>{console.log("App.tsx render state:",{isGuiVisible:e,isTogether:p,myId:f,isChatOpen:u,allNicknamesCount:Object.keys(w||{}).length,allPlayerPositionsCount:Object.keys(k||{}).length});const P=new Oe;h.current=P;const L=()=>{P.onWindowResize()},N=z=>{var U,_;if(!u&&!(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement))switch(z.key){case"/":p&&(z.preventDefault(),l(!0));break;case"c":case"C":p&&l(!0);break;case"h":case"H":t(ae=>!ae);break;case"p":case"P":(_=(U=h.current)==null?void 0:U.getJukebox())==null||_.togglePlay();break}},K=z=>{i(z.songTitle),r(!0)};return window.addEventListener("resize",L),window.addEventListener("keydown",N),document.addEventListener("songchange",K),()=>{window.removeEventListener("resize",L),window.removeEventListener("keydown",N),document.removeEventListener("songchange",K),P.dispose()}},[p]),v.useEffect(()=>{if(!h.current||!M)return;const P=setInterval(()=>{var N;const L=(N=h.current)==null?void 0:N.getPlayerTransform();L&&M(L)},100);return()=>clearInterval(P)},[M]),v.useEffect(()=>{if(!h.current||!f)return;const P={};for(const[L,N]of Object.entries(k))L!==f&&N&&(P[L]=N);h.current.updateRemotePlayerVisuals(P,w)},[k,f,w]);const j=()=>{var P;(P=h.current)==null||P.resetCamera()},T=P=>{var L;(L=h.current)==null||L.setFogDensity(P)},W=P=>{var N;const L=(N=h.current)==null?void 0:N.getJukebox();L&&(L.setVolume(P),d(L.getMutedState()))};return n.jsxs("div",{className:"fixed inset-0 bg-black",children:[n.jsx("canvas",{id:"scene-canvas",className:"w-full h-full block"}),e&&n.jsx(Xe,{}),e&&p&&f&&n.jsx(Ye,{allPlayerPositions:k,myId:f,allNicknames:w,worldSize:((E=h.current)==null?void 0:E.getWorldDimensions())??void 0}),e&&p&&n.jsx(et,{isOpen:u,onClose:()=>l(!1)}),e&&n.jsx("div",{className:"absolute bottom-4 left-4 text-white bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm px-6 py-3 rounded-xl shadow-2xl border border-white/10 max-w-xs z-0",children:n.jsxs("div",{className:"text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),n.jsx("span",{children:"Use WASD to move, mouse to look around"})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),n.jsx("span",{children:"SPACE to jump, F to toggle fly mode"})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"w-2 h-2 bg-pink-400 rounded-full"}),n.jsx("span",{children:"T to toggle wireframe mode, H to toggle GUI"})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full"}),n.jsx("span",{children:"Press P to mute/unmute music and N to skip songs"})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),n.jsx("span",{children:"Press ESC to unlock the mouse"})]}),p&&!u&&n.jsxs("div",{className:"flex items-center gap-2 mb-2 text-cyan-300",children:[n.jsx("span",{className:"w-2 h-2 bg-cyan-400 rounded-full"}),n.jsx("span",{children:"Press '/' to open chat"})]}),window.innerWidth>640&&n.jsxs("div",{className:"flex items-center gap-2 mt-2 text-gray-300",children:[n.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),n.jsx("span",{children:"Q/E for up/down in fly mode"})]})]})}),e&&n.jsxs("div",{className:"absolute top-4 right-4 flex flex-col items-stretch gap-3 p-3 bg-black/50 backdrop-blur-md rounded-xl shadow-2xl border border-white/10 z-20 w-64",children:[n.jsx(Qe,{}),n.jsx("button",{onClick:j,type:"button",className:"w-full bg-gradient-to-r from-black/70 to-black/50 backdrop-blur-sm hover:from-black/80 hover:to-black/60 text-white px-4 py-2.5 rounded-lg shadow-xl border border-white/10 transition-all duration-300 text-sm font-medium",children:"Reset Position"}),n.jsx(_e,{onChange:T}),n.jsx(qe,{onChange:W})]}),e&&n.jsx($e,{title:s,isVisible:a,isMuted:c})]})}console.log("VITE_RT_APP_ID:",void 0);console.log("VITE_MULTISYNQ_API_KEY:","2gseQMIyS1heIRWhVyKNXyGH7j1WARH02cobPAmjq9");const ee=document.getElementById("root"),st={appId:"beachtest1.local.thing",apiKey:"2gseQMIyS1heIRWhVyKNXyGH7j1WARH02cobPAmjq9",name:"vibe-beach-default-lobby",password:"lobbypassword"};if(ee)Ce.createRoot(ee).render(n.jsx(v.StrictMode,{children:n.jsx(Ae,{sessionParams:st,children:n.jsx(tt,{})})}));else throw new Error("Root element with id 'root' not found.");
